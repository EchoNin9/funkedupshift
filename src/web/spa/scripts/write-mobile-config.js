#!/usr/bin/env node
/**
 * Writes config.js for mobile builds from environment variables.
 * Usage: API_BASE_URL=https://... COGNITO_USER_POOL_ID=... COGNITO_CLIENT_ID=... node scripts/write-mobile-config.js
 * Then run: npm run build && npx cap sync
 */
const fs = require("fs");
const path = require("path");

const apiUrl = process.env.API_BASE_URL || process.env.VITE_APP_API_BASE_URL || "";
const poolId = process.env.COGNITO_USER_POOL_ID || process.env.VITE_APP_COGNITO_POOL_ID || "";
const clientId = process.env.COGNITO_CLIENT_ID || process.env.VITE_APP_COGNITO_CLIENT_ID || "";

const config = `// Mobile build config - generated by scripts/write-mobile-config.js
window.API_BASE_URL = "${apiUrl.replace(/\/$/, "")}";
window.COGNITO_USER_POOL_ID = "${poolId}";
window.COGNITO_CLIENT_ID = "${clientId}";
`;

const publicDir = path.join(__dirname, "..", "public");
const configPath = path.join(publicDir, "config.js");

if (!fs.existsSync(publicDir)) {
  fs.mkdirSync(publicDir, { recursive: true });
}

fs.writeFileSync(configPath, config, "utf8");
console.log("Wrote config.js with API_BASE_URL:", apiUrl || "(empty)");
