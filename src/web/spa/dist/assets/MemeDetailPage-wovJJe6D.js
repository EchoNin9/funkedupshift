import{r as l,b as U,u as $,d as F,z as T,y as A,h as I,A as P,j as e,L as d,x as O,f as b}from"./index-BHtdhaZ_.js";import{S as K}from"./ShareMemeBox-EVqAVdaz.js";import{F as h}from"./ArrowLeftIcon-DJQ7xUfc.js";import{F as _}from"./PencilSquareIcon-D8sexxk8.js";import"./LinkIcon-DoK7g8kz.js";function J({title:i,titleId:a,...u},t){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},u),i?l.createElement("title",{id:a},i):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}const H=l.forwardRef(J);function y(){if(typeof window>"u")return null;const i=window.API_BASE_URL;return i?i.replace(/\/$/,""):null}const Q=()=>{const{id:i}=U(),{user:a}=$(),u=F(),[t,p]=l.useState(null),[S,f]=l.useState(!0),[w,m]=l.useState(null),[g,E]=l.useState(!1),[R,j]=l.useState(!1),C=!!t&&(T(a)||A(a)&&t.userId===(a==null?void 0:a.userId)),k=!!t&&I(a,"superadmin"),x=i?decodeURIComponent(i):"";l.useEffect(()=>{const n=y();if(!n||!x){m(x?"API URL not set.":"Missing meme id."),f(!1);return}let s=!1;async function c(){f(!0),m(null);try{const r=await b(`${n}${a?"/memes":"/memes/cache"}?id=${encodeURIComponent(x)}`);if(r.status===404){s||p(null);return}if(!r.ok){const D=await r.text();throw new Error(`HTTP ${r.status}: ${D}`)}const B=await r.json();if(s)return;p(B.meme??null)}catch(o){s||m((o==null?void 0:o.message)??"Failed to load meme.")}finally{s||f(!1)}}return c(),()=>{s=!0}},[x,a]);const L=async n=>{const s=y();if(!(!s||!t))try{const c=await b(`${s}/memes/stars`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({memeId:t.PK,rating:n})});if(c.ok){const o=await c.json();p(r=>r?{...r,averageRating:o.averageRating??n}:null)}}catch{}},M=async()=>{const n=y();if(!(!n||!t)){E(!0),m(null);try{const s=await b(`${n}/memes`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.PK})});if(!s.ok){const c=await s.json();throw new Error(c.error||"Failed to delete meme")}try{sessionStorage.setItem("memes_my_cache_invalidate",JSON.stringify({tagOnly:!1}))}catch{}u("/memes")}catch(s){m((s==null?void 0:s.message)??"Failed to delete meme"),j(!1)}finally{E(!1)}}};if(!a||P(a),a&&!P(a))return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(d,{to:"/memes",className:"inline-flex items-center gap-1 text-sm text-slate-400 hover:text-slate-200",children:[e.jsx(h,{className:"h-4 w-4"}),"Back to Memes"]}),e.jsx("div",{className:"rounded-md border border-slate-700 bg-slate-900/60 px-4 py-3 text-slate-200",children:"Sign in and join Memes group to view."})]});if(S)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(d,{to:"/memes",className:"inline-flex items-center gap-1 text-sm text-slate-400 hover:text-slate-200",children:[e.jsx(h,{className:"h-4 w-4"}),"Back to Memes"]}),e.jsx("div",{className:"text-sm text-slate-400",children:"Loading…"})]});if(w||!t)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(d,{to:"/memes",className:"inline-flex items-center gap-1 text-sm text-slate-400 hover:text-slate-200",children:[e.jsx(h,{className:"h-4 w-4"}),"Back to Memes"]}),e.jsx("div",{className:"rounded-md border border-slate-700 bg-slate-900/60 px-4 py-3 text-slate-200",children:w||"Meme not found."})]});const v=t.title||t.PK||"Untitled",N=t.mediaUrl||t.thumbnailUrl;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex items-center justify-between gap-4",children:[e.jsxs(d,{to:"/memes",className:"inline-flex items-center gap-1 text-sm text-slate-400 hover:text-slate-200",children:[e.jsx(h,{className:"h-4 w-4"}),"Back to Memes"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[C&&e.jsxs(d,{to:`/memes/${encodeURIComponent(t.PK)}/edit`,className:"inline-flex items-center gap-1 text-sm text-slate-400 hover:text-slate-200",children:[e.jsx(_,{className:"h-4 w-4"}),"Edit"]}),k&&!R&&e.jsxs("button",{type:"button",onClick:()=>j(!0),className:"inline-flex items-center gap-1 text-sm text-slate-400 hover:text-red-400",children:[e.jsx(H,{className:"h-4 w-4"}),"Delete"]}),k&&R&&e.jsxs("span",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-red-400",children:"Delete this meme?"}),e.jsx("button",{type:"button",onClick:M,disabled:g,className:"rounded-md bg-red-600 px-2.5 py-1 text-xs font-semibold text-white hover:bg-red-500 disabled:opacity-50",children:g?"Deleting…":"Confirm"}),e.jsx("button",{type:"button",onClick:()=>j(!1),disabled:g,className:"text-xs text-slate-500 hover:text-slate-300",children:"Cancel"})]})]})]}),e.jsx("div",{className:"rounded-xl border border-slate-800 bg-slate-950/60 overflow-hidden min-h-[200px] flex items-center justify-center p-4",children:N?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:N,alt:v,className:"w-full max-w-2xl mx-auto block object-contain max-h-[70vh]",onError:n=>{n.currentTarget.style.display="none";const s=n.currentTarget.nextElementSibling;s&&s.classList.remove("hidden")}}),e.jsx("div",{className:"hidden py-12 text-slate-500","aria-hidden":!0,children:"Image failed to load"})]}):e.jsx("div",{className:"py-12 text-slate-500",children:"No image"})}),e.jsx(K,{memeId:t.PK,title:v,mediaUrl:I(a,"manager")?N:void 0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-xl font-semibold text-slate-50",children:v}),t.isPrivate&&e.jsx("span",{className:"inline-flex rounded-full bg-slate-900 px-2 py-0.5 text-xs uppercase text-slate-500",children:"Private"}),t.description&&e.jsx("p",{className:"text-sm text-slate-300",children:t.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"Tags:"}),t.tags&&t.tags.length>0?t.tags.map(n=>e.jsx("span",{className:"rounded-full bg-slate-800 px-2 py-0.5 text-xs text-slate-300",children:n},n)):e.jsx("span",{className:"text-xs text-slate-500",children:"—"})]}),a&&O(a)&&e.jsx("div",{className:"pt-2",children:e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-slate-400",children:[e.jsx("span",{children:"Rate:"}),e.jsxs("select",{className:"rounded border border-slate-700 bg-slate-950 px-2 py-1 text-sm text-slate-50",onChange:n=>{const s=Number(n.target.value);s>=1&&s<=5&&L(s)},defaultValue:"",children:[e.jsx("option",{value:"",children:"--"}),e.jsx("option",{value:"5",children:"5"}),e.jsx("option",{value:"4",children:"4"}),e.jsx("option",{value:"3",children:"3"}),e.jsx("option",{value:"2",children:"2"}),e.jsx("option",{value:"1",children:"1"})]}),typeof t.averageRating=="number"&&e.jsxs("span",{className:"text-amber-300",children:[t.averageRating.toFixed(1),"★"]})]})})]})]})};export{Q as default};
