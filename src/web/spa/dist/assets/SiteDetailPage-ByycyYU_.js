import{b as U,u as A,h as E,r as i,c as w,j as e,L as d,f as $}from"./index-DYvV5D9I.js";import{F as p}from"./ArrowLeftIcon-Cigvgpax.js";import{F as B}from"./PencilSquareIcon-B2WmaXjG.js";function h(){if(typeof window>"u")return null;const r=window.API_BASE_URL;return r?r.replace(/\/$/,""):null}const F=()=>{var b,N;const{id:r}=U(),{user:o}=A(),v=E(o??null,"manager"),[t,f]=i.useState(null),[x,g]=i.useState(null),[y,m]=i.useState(!0),[j,u]=i.useState(null);i.useEffect(()=>{const s=h();if(!s||!r){u(r?"API URL not set.":"Missing site id."),m(!1);return}let a=!1;async function n(){m(!0),u(null);try{const l=new URLSearchParams;l.set("id",decodeURIComponent(r));const c=await $(`${s}/sites?${l.toString()}`);if(c.status===404){a||f(null);return}if(!c.ok){const k=await c.text();throw new Error(`HTTP ${c.status}: ${k}`)}const S=await c.json();if(a)return;f(S.site??null)}catch(l){a||u((l==null?void 0:l.message)??"Failed to load site.")}finally{a||m(!1)}}return n(),()=>{a=!0}},[r]),i.useEffect(()=>{if(!o||!(t!=null&&t.PK))return;const s=h();if(!s)return;let a=!1;return(async()=>{try{const n=await w(`${s}/stars?siteId=${encodeURIComponent(t.PK)}`);if(a)return;if(n.ok){const l=await n.json();g(typeof l.rating=="number"?l.rating:null)}}catch{}})(),()=>{a=!0}},[o,t==null?void 0:t.PK]);const R=async(s,a)=>{const n=h();if(n)try{await w(`${n}/stars`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({siteId:s,rating:a})}),g(a)}catch{}};if(y)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(d,{to:"/websites",className:"inline-flex items-center gap-1 text-sm text-slate-400 hover:text-slate-200",children:[e.jsx(p,{className:"h-4 w-4"}),"Back to Websites"]}),e.jsx("div",{className:"text-sm text-slate-400",children:"Loading…"})]});if(j||!t)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(d,{to:"/websites",className:"inline-flex items-center gap-1 text-sm text-slate-400 hover:text-slate-200",children:[e.jsx(p,{className:"h-4 w-4"}),"Back to Websites"]}),e.jsx("div",{className:"rounded-md border border-slate-700 bg-slate-900/60 px-4 py-3 text-slate-200",children:j||"Site not found."})]});const P=t.title||t.url||t.PK||"Untitled";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(d,{to:"/websites",className:"inline-flex items-center gap-1 text-sm text-slate-400 hover:text-slate-200",children:[e.jsx(p,{className:"h-4 w-4"}),"Back to Websites"]}),v&&t&&e.jsxs(d,{to:`/admin/sites/edit/${encodeURIComponent(t.PK)}`,className:"inline-flex items-center gap-1 text-sm text-slate-400 hover:text-slate-200",children:[e.jsx(B,{className:"h-4 w-4"}),"Edit site"]})]}),e.jsxs("article",{className:"rounded-xl border border-slate-800 bg-slate-950/60 p-4 sm:p-6",children:[e.jsxs("header",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"h-16 w-16 flex-shrink-0 overflow-hidden rounded-lg border border-slate-700 bg-slate-900",children:t.logoUrl?e.jsx("img",{src:t.logoUrl,alt:"",className:"h-full w-full object-cover",onError:s=>{s.currentTarget.style.visibility="hidden"}}):null}),e.jsxs("div",{className:"min-w-0 flex-1 space-y-1",children:[e.jsx("h1",{className:"text-xl font-semibold tracking-tight text-slate-50",children:P}),typeof t.averageRating=="number"&&e.jsxs("span",{className:"inline-flex items-center rounded-full bg-slate-800 px-2 py-0.5 text-sm text-amber-300",children:[t.averageRating.toFixed(1),"★ average"]}),t.url&&e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"block truncate text-sm text-slate-400 hover:text-slate-200",children:t.url})]})]}),t.description&&e.jsx("div",{className:"mt-4",children:e.jsxs("p",{className:"text-sm text-slate-300",children:[t.description,t.descriptionAiGenerated&&e.jsx("span",{className:"ml-1 text-xs uppercase tracking-wide text-slate-500",children:"AI summary"})]})}),(((b=t.categories)==null?void 0:b.length)??0)>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-1",children:t.categories.map(s=>e.jsx("span",{className:"rounded-full bg-slate-800 px-2 py-0.5 text-xs text-slate-300",children:s.name},s.id))}),(((N=t.tags)==null?void 0:N.length)??0)>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:t.tags.map(s=>e.jsx("span",{className:"rounded-full bg-slate-900 px-2 py-0.5 text-xs text-slate-400",children:s},s))}),o&&e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-3",children:[x!==null&&e.jsxs("span",{className:"text-xs text-slate-400",children:["Your rating: ",x,"★"]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-slate-400",children:[e.jsx("span",{children:"Rate:"}),e.jsxs("select",{className:"rounded border border-slate-700 bg-slate-950 px-2 py-1 text-sm text-slate-50",value:x??"",onChange:s=>{const a=Number(s.target.value);a>=1&&a<=5&&R(t.PK,a)},children:[e.jsx("option",{value:"",children:"--"}),e.jsx("option",{value:"1",children:"1"}),e.jsx("option",{value:"2",children:"2"}),e.jsx("option",{value:"3",children:"3"}),e.jsx("option",{value:"4",children:"4"}),e.jsx("option",{value:"5",children:"5"})]})]})]}),t.scrapedContent&&e.jsxs("section",{className:"mt-6 border-t border-slate-800 pt-4",children:[e.jsx("h2",{className:"text-sm font-medium text-slate-400",children:"About / Scraped content"}),e.jsx("div",{className:"mt-2 overflow-x-auto rounded-lg border border-slate-800 bg-slate-900/60 p-3",children:e.jsx("pre",{className:"whitespace-pre-wrap break-words font-sans text-sm text-slate-300",children:t.scrapedContent})})]})]})]})};export{F as default};
