import{u as P,r,h as U,c as y,j as t,L as T,i as M}from"./index-CqR0r56c.js";import{F as Z}from"./ArrowLeftIcon-NR7umhpe.js";function I(){if(typeof window>"u")return null;const i=window.API_BASE_URL;return i?i.replace(/\/$/,""):null}const J=()=>{const{user:i}=P(),[o,x]=r.useState([]),[n,h]=r.useState("custom"),[c,m]=r.useState(null),[C,u]=r.useState(null),[p,j]=r.useState(""),[E,b]=r.useState(!0),[v,N]=r.useState(!1),[w,D]=r.useState(null),[S,l]=r.useState(null),g=U(i??null,"superadmin"),A=r.useCallback(async()=>{const s=I();if(!s){l("API URL not set."),b(!1);return}b(!0),l(null);try{const e=await y(`${s}/admin/internet-dashboard/sites`);if(!e.ok){const d=await e.json().catch(()=>({}));throw new Error(d.error||"Failed to load")}const a=await e.json();x(Array.isArray(a.sites)?a.sites:[])}catch(e){l((e==null?void 0:e.message)??"Failed to load sites.")}finally{b(!1)}},[y]);r.useEffect(()=>{g&&A()},[g,A]);const f=async s=>{const e=I();if(e){N(!0),D(null),l(null);try{const a=await y(`${e}/admin/internet-dashboard/sites`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sites:s})});if(!a.ok){const d=await a.json().catch(()=>({}));throw new Error(d.error||"Failed to save")}x(s),D("Sites list saved.")}catch(a){l((a==null?void 0:a.message)??"Failed to save.")}finally{N(!1)}}},L=s=>{s.preventDefault();const e=p.trim().toLowerCase().replace(/^https?:\/\//,"").replace(/\/.*$/,"");if(!e)return;if(o.includes(e)){l("Domain already in list.");return}const a=[...o,e];j(""),l(null),f(a)},k=r.useMemo(()=>{if(n==="custom")return[...o];const s=[...o];return s.sort((e,a)=>n==="a-z"?e.localeCompare(a):a.localeCompare(e)),s},[o,n]),$=s=>{m(s)},O=(s,e)=>{s.preventDefault(),s.dataTransfer.dropEffect="move",u(e)},F=()=>{u(null)},R=()=>{m(null),u(null)},z=(s,e)=>{if(s.preventDefault(),u(null),n!=="custom"||c===null||c===e){m(null);return}const a=[...k],[d]=a.splice(c,1);a.splice(e,0,d),x(a),f(a),m(null)},B=s=>{const e=o.filter(a=>a!==s);if(e.length===0){l("At least one site is required.");return}l(null),f(e)};return g?E?t.jsxs("div",{className:"space-y-4",children:[t.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-slate-50",children:"Internet Dashboard"}),t.jsx("p",{className:"text-sm text-slate-400",children:"Loading sites…"})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs(T,{to:"/internet-dashboard",className:"inline-flex items-center gap-1 text-sm text-slate-400 hover:text-slate-200",children:[t.jsx(Z,{className:"h-4 w-4"}),"Back to Internet Dashboard"]}),t.jsxs("header",{className:"space-y-2",children:[t.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-slate-50",children:"Internet Dashboard"}),t.jsx("p",{className:"text-sm text-slate-400",children:"Edit the list of sites shown on the Internet Dashboard. Only SuperAdmin can change this."})]}),t.jsxs("section",{className:"rounded-xl border border-slate-800 bg-slate-950/60 p-4 space-y-4 max-w-2xl",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[t.jsxs("h2",{className:"text-base font-semibold text-slate-200",children:["Sites list (",o.length,")"]}),t.jsxs("div",{className:"inline-flex rounded-md border border-slate-700 bg-slate-950 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>h("custom"),className:`rounded px-2 py-0.5 text-xs font-medium ${n==="custom"?"bg-brand-orange text-slate-950":"text-slate-400 hover:text-slate-200"}`,children:"Custom"}),t.jsx("button",{type:"button",onClick:()=>h("a-z"),className:`rounded px-2 py-0.5 text-xs font-medium ${n==="a-z"?"bg-brand-orange text-slate-950":"text-slate-400 hover:text-slate-200"}`,children:"A–Z"}),t.jsx("button",{type:"button",onClick:()=>h("z-a"),className:`rounded px-2 py-0.5 text-xs font-medium ${n==="z-a"?"bg-brand-orange text-slate-950":"text-slate-400 hover:text-slate-200"}`,children:"Z–A"})]})]}),t.jsxs("form",{onSubmit:L,className:"flex gap-2 flex-wrap items-end",children:[t.jsxs("div",{className:"flex-1 min-w-[12rem]",children:[t.jsx("label",{htmlFor:"newDomain",className:"block text-xs font-medium text-slate-400 mb-1",children:"Add domain"}),t.jsx("input",{id:"newDomain",type:"text",value:p,onChange:s=>j(s.target.value),placeholder:"example.com",className:"w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 focus:border-brand-orange focus:outline-none focus:ring-1 focus:ring-brand-orange"})]}),t.jsx("button",{type:"submit",disabled:v||!p.trim(),className:"rounded-md bg-brand-orange px-4 py-2 text-sm font-medium text-slate-950 hover:bg-orange-500 disabled:opacity-50",children:"Add"})]}),t.jsx("ul",{className:"space-y-2",children:k.map((s,e)=>t.jsxs("li",{draggable:n==="custom",onDragStart:()=>$(e),onDragOver:a=>O(a,e),onDragLeave:F,onDragEnd:R,onDrop:a=>z(a,e),className:`flex items-center gap-2 rounded-md border px-3 py-2 ${c===e?"border-brand-orange bg-slate-800 opacity-60":C===e?"border-brand-orange/70 bg-slate-800/80":"border-slate-700 bg-slate-900"} ${n==="custom"?"cursor-grab active:cursor-grabbing":""}`,children:[n==="custom"&&t.jsx(M,{className:"h-4 w-4 flex-shrink-0 text-slate-500","aria-hidden":!0}),t.jsx("span",{className:"font-medium text-slate-200 break-all flex-1",children:s}),t.jsx("button",{type:"button",onClick:()=>B(s),disabled:v||o.length<=1,className:"flex-shrink-0 rounded-md border border-red-500/60 bg-red-500/10 px-2 py-1 text-xs font-medium text-red-300 hover:bg-red-500/20 disabled:opacity-50",children:"Remove"})]},s))}),w&&t.jsx("div",{className:"rounded-md border border-emerald-500/60 bg-emerald-500/10 px-3 py-2 text-sm text-emerald-200",children:w}),S&&t.jsx("div",{className:"rounded-md border border-red-500/60 bg-red-500/10 px-3 py-2 text-sm text-red-200",children:S})]})]}):t.jsxs("div",{className:"space-y-4",children:[t.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-slate-50",children:"Internet Dashboard"}),t.jsx("p",{className:"text-sm text-slate-400",children:"Only SuperAdmin users can edit the dashboard sites list."})]})};export{J as default};
