import{u as le,a as ne,r as o,h as ie,j as a,L as W,c as A,i as de}from"./index-CqR0r56c.js";import{F as oe}from"./ArrowLeftIcon-NR7umhpe.js";import{F as ce}from"./StarIcon-BWXJXJTn.js";function k(){if(typeof window>"u")return null;const l=window.API_BASE_URL;return l?l.replace(/\/$/,""):null}function G(l){const i=l.trim();return i?i.toLowerCase().startsWith("http://")||i.toLowerCase().startsWith("https://")?i:`https://${i.replace(/^https?:\/\//i,"")}`:null}function H(l){try{return new URL(l.startsWith("http")?l:`https://${l}`).hostname}catch{return l}}const j=[{id:"highlights",label:"Highlights",fetchPath:"/admin/recommended/highlights/sites",savePath:"/admin/recommended/highlights/sites",generatePath:"/admin/recommended/highlights/generate",generateLabel:"Generate new cache",listLabel:"Highlights list",emptyMessage:"No highlights yet. Generate from the highlight category or add a URL above.",generateSuccessMessage:"Cache generated from sites in the highlight category.",saveSuccessMessage:"Highlights list saved.",buttonClass:"bg-violet-600 hover:bg-violet-500",viewPath:"/recommended/highlights"},{id:"highestRated",label:"Highest Rated",fetchPath:"/admin/recommended/highest-rated/sites",savePath:"/admin/recommended/highest-rated/sites",generatePath:"/admin/recommended/highest-rated/generate",generateLabel:"Generate new cache",listLabel:"Highest rated list",emptyMessage:"No items yet. Generate from top 12 by star rating or add a URL above.",generateSuccessMessage:"Cache generated from top 12 sites and media by star rating.",saveSuccessMessage:"Highest rated list saved.",buttonClass:"bg-amber-600 hover:bg-amber-500",viewPath:"/recommended/highest-rated"}],z=({config:l})=>{const[i,h]=o.useState([]),[g,f]=o.useState(null),[p,x]=o.useState(!1),[u,L]=o.useState("custom"),[c,w]=o.useState(null),[V,N]=o.useState(null),[C,P]=o.useState(""),[b,D]=o.useState(null),[$,R]=o.useState(""),[E,U]=o.useState(!1),[K,S]=o.useState(null),[F,m]=o.useState(null),M=o.useRef([]);o.useEffect(()=>{M.current=i},[i]);const O=o.useCallback(async()=>{const e=k();if(e){m(null);try{const t=await A(`${e}${l.fetchPath}`);if(!t.ok){const r=await t.json().catch(()=>({}));throw new Error(r.error||"Failed to load")}const s=await t.json(),n=Array.isArray(s.sites)?s.sites:[];h(n.map(r=>typeof r=="string"?{type:"site",url:r,description:""}:(r.type||"site")==="media"?{type:"media",id:r.id||"",description:r.description||"",title:r.title,thumbnailKey:r.thumbnailKey,averageRating:r.averageRating}:{type:"site",url:r.url||"",description:r.description||"",title:r.title,logoKey:r.logoKey,averageRating:r.averageRating})),f(s.updatedAt??null)}catch(t){m((t==null?void 0:t.message)??"Failed to load sites.")}}},[A,l.fetchPath]);o.useEffect(()=>{O()},[O]);const Z=async()=>{const e=k();if(e){x(!0),S(null),m(null);try{const t=await A(`${e}${l.generatePath}`,{method:"POST"}),s=await t.json();if(!t.ok)throw new Error(s.error||"Failed to generate");const n=Array.isArray(s.sites)?s.sites:[];h(n.map(r=>typeof r=="string"?{type:"site",url:r,description:""}:(r.type||"site")==="media"?{type:"media",id:r.id||"",description:r.description||"",title:r.title,thumbnailKey:r.thumbnailKey,averageRating:r.averageRating}:{type:"site",url:r.url||"",description:r.description||"",title:r.title,logoKey:r.logoKey,averageRating:r.averageRating})),f(s.updatedAt??null),S(l.generateSuccessMessage)}catch(t){m((t==null?void 0:t.message)??"Failed to generate cache.")}finally{x(!1)}}},y=async e=>{const t=k();if(t){U(!0),S(null),m(null);try{const s={sites:e.map(d=>d.type==="media"?{type:"media",id:d.id,description:d.description,...d.title&&{title:d.title},...d.thumbnailKey&&{thumbnailKey:d.thumbnailKey},...d.averageRating!=null&&{averageRating:d.averageRating}}:{type:"site",url:d.url,description:d.description,...d.title&&{title:d.title},...d.logoKey&&{logoKey:d.logoKey},...d.averageRating!=null&&{averageRating:d.averageRating}})},n=await A(`${t}${l.savePath}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),r=await n.json();if(!n.ok)throw new Error(r.error||"Failed to save");h(e),S(l.saveSuccessMessage),f(r.updatedAt??null)}catch(s){m((s==null?void 0:s.message)??"Failed to save.")}finally{U(!1)}}},_=e=>{e.preventDefault();const t=G(C);if(t){if(i.some(s=>s.url===t)){m("URL already in list.");return}P(""),m(null),y([...i,{type:"site",url:t,description:""}])}},T=e=>e.type==="media"?(e.title||e.id||"").toLowerCase():H(e.url||"").toLowerCase(),v=o.useMemo(()=>{if(u==="custom")return[...i];const e=[...i];return e.sort((t,s)=>{const n=T(t),r=T(s);return u==="a-z"?n.localeCompare(r):r.localeCompare(n)}),e},[i,u]),J=e=>{const t=v[e];t.type!=="media"&&(D(e),R(t.url||""))},B=()=>{if(b===null)return;const e=G($);if(!e){m("Invalid URL.");return}const t=v[b];if(t.type==="media")return;if(i.some(n=>n.type==="site"&&n.url===e&&n.url!==t.url)){m("URL already in list.");return}m(null);const s=i.map(n=>n.type==="site"&&n.url===t.url?{...n,url:e}:n);h(s),y(s),D(null),R("")},q=()=>{D(null),R("")},Q=(e,t)=>{h(s=>s.map(n=>(n.type==="media"?n.id===e.id:n.url===e.url)?{...n,description:t.slice(0,255)}:n))},X=()=>{y(M.current)},Y=e=>w(e),ee=(e,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",N(t)},te=()=>N(null),ae=()=>{w(null),N(null)},se=(e,t)=>{if(e.preventDefault(),N(null),u!=="custom"||c===null||c===t){w(null);return}const s=[...v],[n]=s.splice(c,1);s.splice(t,0,n),h(s),y(s),w(null)},re=e=>{m(null),y(i.filter(t=>t.type==="media"?t.id!==e.id:t.url!==e.url))},I=g?new Date(g).toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}):null;return a.jsxs("section",{className:"rounded-xl border border-slate-800 bg-slate-950/60 p-4 space-y-4 max-w-2xl",children:[a.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[a.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[a.jsxs("h2",{className:"text-base font-semibold text-slate-200",children:[l.listLabel," (",i.length,")"]}),I&&a.jsxs("span",{className:"text-xs text-slate-500",children:["Cache was last updated ",I]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(W,{to:l.viewPath,className:"text-sm text-slate-400 hover:text-slate-200",children:"View"}),a.jsx("button",{type:"button",onClick:Z,disabled:p,className:`rounded-md px-4 py-2 text-sm font-medium text-white disabled:opacity-50 ${l.buttonClass}`,children:p?"Generating…":l.generateLabel})]})]}),a.jsx("div",{className:"flex flex-wrap items-center gap-3",children:a.jsx("div",{className:"inline-flex rounded-md border border-slate-700 bg-slate-950 p-0.5",children:["custom","a-z","z-a"].map(e=>a.jsx("button",{type:"button",onClick:()=>L(e),className:`rounded px-2 py-0.5 text-xs font-medium ${u===e?"bg-brand-orange text-slate-950":"text-slate-400 hover:text-slate-200"}`,children:e==="custom"?"Custom":e==="a-z"?"A–Z":"Z–A"},e))})}),a.jsxs("form",{onSubmit:_,className:"flex gap-2 flex-wrap items-end",children:[a.jsxs("div",{className:"flex-1 min-w-[12rem]",children:[a.jsx("label",{htmlFor:"newUrl",className:"block text-xs font-medium text-slate-400 mb-1",children:"Add URL"}),a.jsx("input",{id:"newUrl",type:"text",value:C,onChange:e=>P(e.target.value),placeholder:"https://example.com or example.com",className:"w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 focus:border-brand-orange focus:outline-none focus:ring-1 focus:ring-brand-orange"})]}),a.jsx("button",{type:"submit",disabled:E||!C.trim(),className:"rounded-md bg-brand-orange px-4 py-2 text-sm font-medium text-slate-950 hover:bg-orange-500 disabled:opacity-50",children:"Add"})]}),a.jsx("ul",{className:"space-y-3",children:v.map((e,t)=>a.jsxs("li",{draggable:u==="custom"&&b===null,onDragStart:()=>Y(t),onDragOver:s=>ee(s,t),onDragLeave:te,onDragEnd:ae,onDrop:s=>se(s,t),className:`flex flex-col gap-2 rounded-md border px-3 py-2 ${c===t?"border-brand-orange bg-slate-800 opacity-60":V===t?"border-brand-orange/70 bg-slate-800/80":"border-slate-700 bg-slate-900"} ${u==="custom"&&b===null?"cursor-grab active:cursor-grabbing":""}`,children:[a.jsxs("div",{className:"flex items-center gap-2",children:[u==="custom"&&a.jsx(de,{className:"h-4 w-4 flex-shrink-0 text-slate-500","aria-hidden":!0}),b===t?a.jsx("input",{type:"text",value:$,onChange:s=>R(s.target.value),onBlur:B,onKeyDown:s=>{s.key==="Enter"&&B(),s.key==="Escape"&&q()},autoFocus:!0,className:"flex-1 rounded-md border border-slate-600 bg-slate-900 px-2 py-1 text-sm text-slate-50 focus:border-brand-orange focus:outline-none focus:ring-1 focus:ring-brand-orange"}):e.type==="media"?a.jsx("span",{className:"font-medium text-slate-200 break-all flex-1",children:e.title||e.id}):a.jsx("button",{type:"button",onClick:()=>J(t),className:"font-medium text-slate-200 break-all flex-1 text-left hover:text-brand-orange hover:underline",children:H(e.url||"")}),l.id==="highestRated"&&e.averageRating!=null&&a.jsxs("span",{className:"flex items-center gap-0.5 text-amber-400 text-xs",children:[a.jsx(ce,{className:"h-3.5 w-3.5"}),e.averageRating]}),a.jsx("button",{type:"button",onClick:()=>re(e),disabled:E||b!==null,className:"flex-shrink-0 rounded-md border border-red-500/60 bg-red-500/10 px-2 py-1 text-xs font-medium text-red-300 hover:bg-red-500/20 disabled:opacity-50",children:"Remove"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:`desc-${l.id}-${t}`,className:"block text-xs font-medium text-slate-400 mb-0.5",children:"Description"}),a.jsx("input",{id:`desc-${l.id}-${t}`,type:"text",value:e.description,onChange:s=>Q(e,s.target.value),onBlur:X,maxLength:255,placeholder:"One-line description (255 chars max)",disabled:E,className:"w-full rounded-md border border-slate-700 bg-slate-950 px-2 py-1 text-sm text-slate-50 placeholder:text-slate-500 focus:border-brand-orange focus:outline-none focus:ring-1 focus:ring-brand-orange disabled:opacity-50"}),a.jsxs("span",{className:"text-[10px] text-slate-500",children:[e.description.length,"/255"]})]})]},e.id||e.url||t))}),v.length===0&&a.jsx("p",{className:"text-sm text-slate-500",children:l.emptyMessage}),K&&a.jsx("div",{className:"rounded-md border border-emerald-500/60 bg-emerald-500/10 px-3 py-2 text-sm text-emerald-200",children:K}),F&&a.jsx("div",{className:"rounded-md border border-red-500/60 bg-red-500/10 px-3 py-2 text-sm text-red-200",children:F})]})},ge=()=>{const{user:l}=le(),[i,h]=ne(),g=i.get("tab"),f=g==="highest-rated"||g==="highestRated"?"highestRated":"highlights",[p,x]=o.useState(f);o.useEffect(()=>{x(g==="highest-rated"||g==="highestRated"?"highestRated":"highlights")},[g]);const u=c=>{x(c),h({tab:c==="highestRated"?"highest-rated":c},{replace:!0})},L=ie(l??null,"manager");return j.find(c=>c.id===p)??j[0],L?a.jsxs("div",{className:"space-y-6",children:[a.jsxs(W,{to:"/recommended/highlights",className:"inline-flex items-center gap-1 text-sm text-slate-400 hover:text-slate-200",children:[a.jsx(oe,{className:"h-4 w-4"}),"Back to Recommended"]}),a.jsxs("header",{className:"space-y-2",children:[a.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-slate-50",children:"Recommended Admin"}),a.jsx("p",{className:"text-sm text-slate-400",children:"Manage highlighted and highest-rated site lists. Generate from categories or star ratings, or edit manually."})]}),a.jsx("div",{className:"flex gap-2 border-b border-slate-800 pb-2",children:j.map(c=>a.jsx("button",{type:"button",onClick:()=>u(c.id),className:`px-4 py-2 rounded-md text-sm font-medium ${p===c.id?"bg-slate-800 text-slate-100":"text-slate-400 hover:text-slate-200"}`,children:c.label},c.id))}),p==="highlights"&&a.jsx(z,{config:j[0]}),p==="highestRated"&&a.jsx(z,{config:j[1]})]}):a.jsxs("div",{className:"space-y-4",children:[a.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-slate-50",children:"Recommended Admin"}),a.jsx("p",{className:"text-sm text-slate-400",children:"Only Manager or SuperAdmin users can edit the recommended caches."})]})};export{ge as default};
