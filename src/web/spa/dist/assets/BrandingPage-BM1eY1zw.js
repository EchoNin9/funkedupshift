import{u as je,e as ye,r as n,h as Ne,j as e,D as we,i as ve,k as Se,c as p}from"./index-BHtdhaZ_.js";import{A as ne}from"./AdminPageHeader-dlKsnSEs.js";import"./ArrowLeftIcon-DJQ7xUfc.js";function h(){if(typeof window>"u")return null;const b=window.API_BASE_URL;return b?b.replace(/\/$/,""):null}const re=["image/png","image/jpeg","image/jpg","image/gif","image/webp"],ke=()=>{const{user:b}=je(),{logo:S,heroTagline:T,heroHeadline:U,heroSubtext:E,heroImageUrl:O,heroOpacity:k,refreshBranding:P}=ye(),[d,ie]=n.useState(null),[B,oe]=n.useState("Funkedupshift"),[g,$]=n.useState(null),[D,G]=n.useState(!1),[J,A]=n.useState(null),[M,c]=n.useState(null),[_,W]=n.useState(T),[q,z]=n.useState(U),[X,K]=n.useState(E),[j,Q]=n.useState(null),[m,C]=n.useState(null),[R,V]=n.useState(k),[y,N]=n.useState(!1),[Y,f]=n.useState(null),[Z,i]=n.useState(null),[L,F]=n.useState([]),[w,ee]=n.useState(null),[H,te]=n.useState(""),[de,se]=n.useState(!1),[ae,x]=n.useState(null),[le,u]=n.useState(null),I=Ne(b??null,"superadmin");if(n.useEffect(()=>{W(T),z(U),K(E),V(k)},[T,U,E,k]),n.useEffect(()=>{const t=h();!t||!I||Promise.all([fetch(`${t}/branding/themes`).then(a=>a.ok?a.json():{themes:[]}),fetch(`${t}/branding/active-theme`).then(a=>a.ok?a.json():{themeId:null})]).then(([a,s])=>{F(a.themes??[]),ee(s.themeId??null)})},[I]),!I)return e.jsx("div",{className:"space-y-6",children:e.jsx(ne,{title:"Branding",description:"Only superadmin users can manage global branding assets."})});const ce=t=>{var s;const a=(s=t.target.files)==null?void 0:s[0];ie(a??null),A(null),c(null),g&&(URL.revokeObjectURL(g),$(null)),a&&$(URL.createObjectURL(a))},me=t=>{var s;const a=(s=t.target.files)==null?void 0:s[0];Q(a??null),f(null),i(null),m&&(URL.revokeObjectURL(m),C(null)),a&&C(URL.createObjectURL(a))},ue=async t=>{if(t.preventDefault(),c(null),A(null),!d){c("Choose an image file first.");return}const a=d.type||"image/png";if(!re.includes(a)){c("Logo must be PNG, JPEG, GIF, or WEBP.");return}const s=h();if(!s){c("API URL not configured.");return}const l=window;if(!l.auth||typeof l.auth.getAccessToken!="function"){c("Auth not initialized.");return}G(!0);try{const r=await p(`${s}/branding/logo`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contentType:a,alt:B})});if(!r.ok){const be=await r.text();throw new Error(be||`Metadata request failed with ${r.status}`)}const o=await r.json();if(!o.uploadUrl)throw new Error("uploadUrl missing from response.");const v=await fetch(o.uploadUrl,{method:"PUT",headers:{"Content-Type":a},body:d});if(!v.ok)throw new Error(`Upload failed with ${v.status}`);A("Logo updated. It may take a moment for caches to refresh."),await P()}catch(r){c((r==null?void 0:r.message)??"Failed to update logo.")}finally{G(!1)}},he=async t=>{t.preventDefault(),i(null),f(null);const a=h();if(!a){i("API URL not configured.");return}N(!0);try{const s=await p(`${a}/branding/hero`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({tagline:_,headline:q,subtext:X,opacity:R})});if(!s.ok){const l=await s.json().catch(()=>({}));throw new Error(l.error||"Failed to update hero texts.")}f("Hero texts updated."),await P()}catch(s){i((s==null?void 0:s.message)??"Failed to update.")}finally{N(!1)}},xe=async t=>{if(t.preventDefault(),i(null),f(null),!j){i("Choose an image file first.");return}const a=j.type||"image/png";if(!re.includes(a)){i("Image must be PNG, JPEG, GIF, or WEBP.");return}const s=h();if(!s){i("API URL not configured.");return}N(!0);try{const l=await p(`${s}/branding/hero`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contentType:a})});if(!l.ok){const v=await l.text();throw new Error(v||"Failed to get upload URL.")}const r=await l.json();if(!r.uploadUrl)throw new Error("uploadUrl missing from response.");const o=await fetch(r.uploadUrl,{method:"PUT",headers:{"Content-Type":a},body:j});if(!o.ok)throw new Error(`Upload failed with ${o.status}`);f("Hero background image updated."),Q(null),m&&(URL.revokeObjectURL(m),C(null)),await P()}catch(l){i((l==null?void 0:l.message)??"Failed to update hero image.")}finally{N(!1)}},pe=async t=>{u(null),x(null);const a=h();if(a)try{const s=await p(`${a}/branding/active-theme`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({themeId:t||""})});if(!s.ok){const l=await s.json().catch(()=>({}));throw new Error(l.error||"Failed to set theme.")}ee(t),x("Active theme updated.")}catch(s){u((s==null?void 0:s.message)??"Failed to set theme.")}},ge=async t=>{t.preventDefault(),u(null),x(null);const a=H.trim();if(!a)return;const s=h();if(s){se(!0);try{const l=await p(`${s}/branding/themes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a})});if(!l.ok){const o=await l.json().catch(()=>({}));throw new Error(o.error||"Failed to create theme.")}const r=await l.json();F(o=>[...o,r]),te(""),x(`Theme "${r.name}" created.`)}catch(l){u((l==null?void 0:l.message)??"Failed to create theme.")}finally{se(!1)}}},fe=async t=>{if(t===w){u("Cannot delete the theme currently in use.");return}u(null),x(null);const a=h();if(a)try{const s=await p(`${a}/branding/themes/${encodeURIComponent(t)}`,{method:"DELETE"});if(!s.ok){const l=await s.json().catch(()=>({}));throw new Error(l.error||"Failed to delete theme.")}F(l=>l.filter(r=>r.id!==t)),x("Theme deleted.")}catch(s){u((s==null?void 0:s.message)??"Failed to delete theme.")}};return e.jsxs("div",{className:"space-y-8",children:[e.jsx(ne,{title:"Branding",description:"Manage global logo, hero section, and themes."}),e.jsxs("form",{className:"card p-6 space-y-4 max-w-md",onSubmit:ue,children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-200",children:"Logo"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("label",{className:"block text-slate-200",children:"Logo image"}),S&&!g&&e.jsxs("div",{className:"space-y-1 mb-3",children:[e.jsx("p",{className:"text-slate-200",children:"Current logo"}),e.jsx("div",{className:"inline-flex items-center rounded-lg border border-slate-800 bg-slate-950 p-2",children:e.jsx("img",{src:S.url,alt:S.alt,className:"h-12 w-auto rounded-md object-contain"})})]}),e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/jpg,image/gif,image/webp",onChange:ce,className:"block w-full text-xs text-slate-300 file:mr-3 file:rounded-md file:border-0 file:bg-slate-800 file:px-3 file:py-1.5 file:text-xs file:font-semibold file:text-slate-100 hover:file:bg-slate-700"}),e.jsx("p",{className:"text-xs text-slate-500",children:"PNG, JPEG, GIF, or WEBP. Recommended square or horizontal layout."})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("label",{className:"block text-slate-200",children:"Alt text"}),e.jsx("input",{type:"text",value:B,onChange:t=>oe(t.target.value),className:"input-field"})]}),g&&e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("p",{className:"text-slate-200",children:"Preview"}),e.jsxs("div",{className:"inline-flex items-center rounded-lg border border-slate-800 bg-slate-950 p-2",children:[e.jsx("img",{src:g,alt:"Preview",className:"h-12 w-auto rounded-md object-contain"}),e.jsx("span",{className:"ml-3 text-xs text-slate-400 truncate max-w-[12rem]",children:d==null?void 0:d.name})]})]}),e.jsx("button",{type:"submit",disabled:D||!d,className:"btn-primary disabled:opacity-50",children:D?"Updating…":"Update logo"}),J&&e.jsx("div",{className:"rounded-md border border-emerald-500/60 bg-emerald-500/10 px-3 py-2 text-xs text-emerald-200",children:J}),M&&e.jsx("div",{className:"rounded-md border border-red-500/60 bg-red-500/10 px-3 py-2 text-xs text-red-200",children:M})]}),e.jsxs("form",{className:"card p-6 space-y-4 max-w-md",onSubmit:he,children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-200",children:"Hero section text"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Edit the text displayed on the homepage hero."}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("label",{className:"block text-slate-200",children:"Tagline"}),e.jsx("input",{type:"text",value:_,onChange:t=>W(t.target.value),placeholder:we,className:"input-field"})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("label",{className:"block text-slate-200",children:"Headline"}),e.jsx("input",{type:"text",value:q,onChange:t=>z(t.target.value),placeholder:ve,className:"input-field"})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("label",{className:"block text-slate-200",children:"Subtext"}),e.jsx("textarea",{value:X,onChange:t=>K(t.target.value),placeholder:Se,className:"input-field min-h-[80px]",rows:3})]}),e.jsx("button",{type:"submit",disabled:y,className:"btn-primary disabled:opacity-50",children:y?"Saving…":"Save hero text"}),Y&&e.jsx("div",{className:"rounded-md border border-emerald-500/60 bg-emerald-500/10 px-3 py-2 text-xs text-emerald-200",children:Y}),Z&&e.jsx("div",{className:"rounded-md border border-red-500/60 bg-red-500/10 px-3 py-2 text-xs text-red-200",children:Z})]}),e.jsxs("form",{className:"card p-6 space-y-4 max-w-md",onSubmit:xe,children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-200",children:"Hero background image"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Image displayed behind the hero text. Adjust opacity below."}),O&&!m&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-slate-200",children:"Current image"}),e.jsx("div",{className:"rounded-lg border border-slate-800 overflow-hidden max-h-32",children:e.jsx("img",{src:O,alt:"Hero background",className:"w-full h-32 object-cover"})})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("label",{className:"block text-slate-200",children:"Image opacity"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:R,onChange:t=>V(parseFloat(t.target.value)),className:"flex-1"}),e.jsxs("span",{className:"text-xs text-slate-400 w-12",children:[Math.round(R*100),"%"]})]})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("label",{className:"block text-slate-200",children:"Upload new image"}),e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/jpg,image/gif,image/webp",onChange:me,className:"block w-full text-xs text-slate-300 file:mr-3 file:rounded-md file:border-0 file:bg-slate-800 file:px-3 file:py-1.5 file:text-xs file:font-semibold file:text-slate-100 hover:file:bg-slate-700"})]}),m&&e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("p",{className:"text-slate-200",children:"Preview"}),e.jsx("div",{className:"rounded-lg border border-slate-800 overflow-hidden max-h-32",children:e.jsx("img",{src:m,alt:"Preview",className:"w-full h-32 object-cover"})})]}),e.jsx("button",{type:"submit",disabled:y||!j,className:"btn-primary disabled:opacity-50",children:y?"Uploading…":"Update hero image"})]}),e.jsxs("div",{className:"card p-6 space-y-4 max-w-md",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-200",children:"Themes"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Select the active theme. Add or delete themes below."}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("label",{className:"block text-slate-200",children:"Active theme"}),e.jsxs("select",{value:w??"",onChange:t=>pe(t.target.value||null),className:"input-field",children:[e.jsx("option",{value:"",children:"Default (none)"}),L.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("form",{onSubmit:ge,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:H,onChange:t=>te(t.target.value),placeholder:"New theme name",className:"input-field flex-1"}),e.jsx("button",{type:"submit",disabled:de||!H.trim(),className:"btn-primary disabled:opacity-50",children:"Add"})]}),L.length>0&&e.jsx("ul",{className:"space-y-2",children:L.map(t=>e.jsxs("li",{className:"flex items-center justify-between rounded-lg border border-slate-800 px-3 py-2 text-sm",children:[e.jsx("span",{className:"text-slate-200",children:t.name}),e.jsx("button",{type:"button",onClick:()=>fe(t.id),disabled:t.id===w,className:"text-red-400 hover:text-red-300 text-xs disabled:opacity-50 disabled:cursor-not-allowed",children:t.id===w?"In use":"Delete"})]},t.id))}),ae&&e.jsx("div",{className:"rounded-md border border-emerald-500/60 bg-emerald-500/10 px-3 py-2 text-xs text-emerald-200",children:ae}),le&&e.jsx("div",{className:"rounded-md border border-red-500/60 bg-red-500/10 px-3 py-2 text-xs text-red-200",children:le})]})]})};export{ke as default};
