import{u as Je,p as Ye,r as m,c as _,R as Le,j as e,q as He}from"./index-Cx0qYlZr.js";import{A as We}from"./AdminTabs-Bl2sYCAF.js";function I(){if(typeof window>"u")return null;const c=window.API_BASE_URL;return c?c.replace(/\/$/,""):null}function Ge(c){return c.split(/\r?\n/).filter(w=>w.trim()).map(w=>{const b=[];let j="",a=!1;for(let f=0;f<w.length;f++){const o=w[f];o==='"'?a=!a:o===","&&!a?(b.push(j.trim()),j=""):j+=o}return b.push(j.trim()),b})}function Xe(c){if(c==null||c==="")return 0;if(typeof c=="number"&&!isNaN(c))return c;let x=String(c).replace(/[$€£¥\s]/g,"");x.includes(".")?x=x.replace(/,/g,""):x=x.replace(/,/g,".");const w=parseFloat(x);return isNaN(w)?0:w}function Ze(c){return String(c??"").trim()||"Vehicle"}function qe(c){if(!c)return"—";try{const x=new Date(c+"T12:00:00Z");if(isNaN(x.getTime()))return c;const w=x.getUTCFullYear(),b=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][x.getUTCMonth()],j=String(x.getUTCDate()).padStart(2,"0");return`${w}-${b}-${j}`}catch{return c||"—"}}function Ee({data:c,valueKey:x,label:w,formatValue:b,color:j}){if(c.length===0)return null;const a=600,f=180,o={t:20,r:40,b:30,l:50},E=c.map(u=>u[x]).filter(u=>u!=null&&!isNaN(u)),R=Math.min(...E,0),M=Math.max(...E,R+.01),ee=M-R||1,H=u=>o.l+u/Math.max(1,c.length-1)*(a-o.l-o.r),W=u=>o.t+f-o.t-o.b-(u-R)/ee*(f-o.t-o.b),N=c.map((u,v)=>{const D=u[x];return D==null||isNaN(D)?null:`${H(v)},${W(D)}`}).filter(Boolean);return e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-400 mb-1",children:w}),e.jsxs("svg",{viewBox:`0 0 ${a} ${f}`,className:"w-full max-w-full",preserveAspectRatio:"xMidYMid meet",children:[e.jsx("line",{x1:o.l,y1:f-o.b,x2:a-o.r,y2:f-o.b,stroke:"currentColor",strokeOpacity:.2}),e.jsx("line",{x1:o.l,y1:o.t,x2:o.l,y2:f-o.b,stroke:"currentColor",strokeOpacity:.2}),N.length>1&&e.jsx("polyline",{fill:"none",stroke:j,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",points:N.join(" ")}),c.map((u,v)=>{const D=u[x];return D==null||isNaN(D)?null:e.jsx("circle",{cx:H(v),cy:W(D),r:"3",fill:j},v)})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Range: ",b(R)," – ",b(M)]})]})}function oe(c,x){const w=c.fuelPrice??c.fuel_price??0,b=c.fuelLitres??0,j=c.odometerKm??0,a=(x==null?void 0:x.odometerKm)??j,f=Math.max(0,j-a),o=b>0?w/b:null,E=f>0&&b>0?b/f*100:null,R=E!=null&&E>0?235.215/E:null;return{pricePerLitre:o,distanceKm:f,lPer100km:E,mpg:R}}const tt=()=>{var ye;const{user:c}=Je(),x=Ye(c),w=m.useRef(null),[b,j]=m.useState([]),[a,f]=m.useState(null),[o,E]=m.useState([]),[R,M]=m.useState(!0),[ee,H]=m.useState(!1),[W,N]=m.useState(null),[u,v]=m.useState(!1),[D,te]=m.useState(!1),[se,ce]=m.useState(""),[V,G]=m.useState({date:new Date().toISOString().slice(0,10),fuelPrice:"",fuelLitres:"",odometerKm:""}),[de,me]=m.useState(!1),[xe,ue]=m.useState(null),[pe,Pe]=m.useState(!1),[q,X]=m.useState(null),[z,B]=m.useState(""),[ke,J]=m.useState(null),[P,Z]=m.useState({date:"",fuelPrice:"",fuelLitres:"",odometerKm:""}),[he,Ve]=m.useState(!1),[fe,$e]=m.useState(!1),[O,T]=m.useState({startDate:"",endDate:"",sortNewestFirst:!0,fuelPriceOp:"higher",fuelPriceVal:"",pricePerLOp:"higher",pricePerLVal:""}),le=m.useCallback(async()=>{var s;const t=I();if(t){M(!0),N(null);try{const l=await _(`${t}/vehicles-expenses`);if(!l.ok){const r=await l.json().catch(()=>({}));throw new Error(r.error||"Failed to load vehicles")}const n=(await l.json()).vehicles??[];j(n),n.length>0&&!a&&f(n[0].id),a&&!n.find(r=>r.id===a)&&f(((s=n[0])==null?void 0:s.id)??null)}catch(l){N(l instanceof Error?l.message:"Failed to load vehicles"),j([])}finally{M(!1)}}},[a]),Y=m.useCallback(async t=>{const s=I();if(s){H(!0);try{const l=await _(`${s}/vehicles-expenses/${encodeURIComponent(t)}/fuel`);if(!l.ok)throw new Error("Failed to load fuel entries");const n=(await l.json()).entries??[];n.sort((r,g)=>(g.date||"").localeCompare(r.date||"")),E(n)}catch{E([])}finally{H(!1)}}},[]);m.useEffect(()=>{x?le():M(!1)},[x,le]),m.useEffect(()=>{a?Y(a):E([])},[a,Y]),m.useEffect(()=>{q&&q!==a&&(X(null),B(""))},[a,q]),m.useEffect(()=>{J(null)},[a]);const ge=Le.useMemo(()=>{const t=new Map;for(let s=0;s<o.length;s++){const l=o[s+1]??null,{pricePerLitre:d}=oe(o[s],l);t.set(o[s].id,d)}return t},[o]),U=Le.useMemo(()=>{let t=[...o];const{startDate:s,endDate:l,sortNewestFirst:d,fuelPriceOp:n,fuelPriceVal:r,pricePerLOp:g,pricePerLVal:F}=O;s&&(t=t.filter(S=>(S.date??"")>=s)),l&&(t=t.filter(S=>(S.date??"")<=l));const y=parseFloat(r);!isNaN(y)&&r&&(t=t.filter(S=>{const $=S.fuelPrice??S.fuel_price??0;return n==="higher"?$>=y:$<=y}));const h=parseFloat(F);return!isNaN(h)&&F&&(t=t.filter(S=>{const $=ge.get(S.id);return $==null?!1:g==="higher"?$>=h:$<=h})),t.sort((S,$)=>d?($.date||"").localeCompare(S.date||""):(S.date||"").localeCompare($.date||"")),t},[o,O,ge]),De=async()=>{const t=se.trim();if(!t)return;const s=I();if(s){v(!0),N(null);try{const l=await _(`${s}/vehicles-expenses`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t})});if(!l.ok){const n=await l.json().catch(()=>({}));throw new Error(n.error||"Failed to create")}const d=await l.json();j(n=>[...n,d]),f(d.id),ce(""),te(!1)}catch(l){N(l instanceof Error?l.message:"Failed to create vehicle")}finally{v(!1)}}},Oe=async()=>{if(!a)return;const t=I();if(!t)return;const s=parseFloat(V.fuelPrice),l=parseFloat(V.fuelLitres),d=parseFloat(V.odometerKm);if(!(isNaN(s)||isNaN(l)||isNaN(d))){v(!0),N(null);try{const n=await _(`${t}/vehicles-expenses/${encodeURIComponent(a)}/fuel`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:V.date,fuelPrice:s,fuelLitres:l,odometerKm:d})});if(!n.ok){const r=await n.json().catch(()=>({}));throw new Error(r.error||"Failed to add")}G({date:new Date().toISOString().slice(0,10),fuelPrice:"",fuelLitres:"",odometerKm:""}),Y(a)}catch(n){N(n instanceof Error?n.message:"Failed to add fuel entry")}finally{v(!1)}}},Ae=async t=>{var n;const s=b.find(r=>r.id===t),l=(s==null?void 0:s.name)||"this vehicle";if(!window.confirm(`Delete "${l}"? This will permanently remove the vehicle and all its fuel entries.`))return;const d=I();if(d){v(!0),N(null);try{const r=await _(`${d}/vehicles-expenses/${encodeURIComponent(t)}`,{method:"DELETE"});if(!r.ok){const g=await r.json().catch(()=>({}));throw new Error(g.error||"Failed to delete")}if(j(g=>g.filter(F=>F.id!==t)),a===t){const g=b.filter(F=>F.id!==t);f(((n=g[0])==null?void 0:n.id)??null)}E([])}catch(r){N(r instanceof Error?r.message:"Failed to delete vehicle")}finally{v(!1)}}},be=async(t,s)=>{const l=s.trim();if(!l)return;const d=I();if(d){v(!0),N(null);try{const n=await _(`${d}/vehicles-expenses/${encodeURIComponent(t)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:l})});if(!n.ok){const g=await n.json().catch(()=>({}));throw new Error(g.error||"Failed to rename")}const r=await n.json();j(g=>g.map(F=>F.id===t?{...F,name:r.name}:F)),X(null),B("")}catch(n){N(n instanceof Error?n.message:"Failed to rename vehicle")}finally{v(!1)}}},Ne=async t=>{if(!a)return;const s=parseFloat(P.fuelPrice),l=parseFloat(P.fuelLitres),d=parseFloat(P.odometerKm);if(isNaN(s)||isNaN(l)||isNaN(d))return;const n=I();if(n){v(!0),N(null);try{const r=await _(`${n}/vehicles-expenses/${encodeURIComponent(a)}/fuel/${encodeURIComponent(t)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:P.date,fuelPrice:s,fuelLitres:l,odometerKm:d})});if(!r.ok){const g=await r.json().catch(()=>({}));throw new Error(g.error||"Failed to update")}J(null),Y(a)}catch(r){N(r instanceof Error?r.message:"Failed to update fuel entry")}finally{v(!1)}}},je=async t=>{if(!a||!window.confirm("Delete this fuel entry?"))return;const s=I();if(s){v(!0),N(null);try{if(!(await _(`${s}/vehicles-expenses/${encodeURIComponent(a)}/fuel/${encodeURIComponent(t)}`,{method:"DELETE"})).ok)throw new Error("Failed to delete");J(null),Y(a)}catch(l){N(l instanceof Error?l.message:"Failed to delete")}finally{v(!1)}}},_e=async t=>{var l,d,n;const s=(l=t.target.files)==null?void 0:l[0];if(s){me(!0),ue(null),N(null);try{let r,g=25569;if(s.name.toLowerCase().endsWith(".csv")||s.type==="text/csv"){const p=await s.text();if(r=Ge(p),!r.length)throw new Error("CSV file is empty")}else{const p=await He(()=>import("./xlsx-D_0l8YDs.js"),[]),i=await s.arrayBuffer(),C=p.read(i,{type:"array",raw:!0}),k=C.SheetNames[0];if(!k)throw new Error("Excel file has no sheets");const L=C.Sheets[k];if(!L)throw new Error("Could not read first sheet");if(r=p.utils.sheet_to_json(L,{header:1,raw:!0,defval:""}),!r.length)throw new Error("Excel sheet is empty");g=!!((n=(d=C.Workbook)==null?void 0:d.WBProps)!=null&&n.date1904)?24107:25569}const y=[],h={},S=r[0];for(let p=0;p<S.length;p++){const i=String(S[p]??"").toLowerCase().trim();i&&(i.includes("date")?h.date=p:i.includes("litre")||i.includes("liter")||i.includes("volume")?h.fuelLitres=p:i.includes("price")||i.includes("cost")||i.includes("amount")?h.fuelPrice=p:i.includes("odometer")||i.includes("mileage")||i.includes("km")&&!i.includes("l/100")?h.odometerKm=p:(i.includes("vehicle")||i==="car"||i.includes("car name"))&&(h.vehicle=p))}const $=h.date??0,Ke=h.fuelPrice??1,Te=h.fuelLitres??2,Ue=h.odometerKm??3,ve=h.vehicle,Q={};for(let p=1;p<r.length;p++){const i=r[p];if(!Array.isArray(i))continue;const C=i[$],k=i[Ke],L=i[Te],A=i[Ue],ae=ve!==void 0?i[ve]:void 0;if(C==null&&k==null&&L==null&&A==null||C===""&&k===""&&L===""&&A==="")continue;let K="";typeof C=="number"&&!isNaN(C)&&C>0?K=new Date((C-g)*86400*1e3).toISOString().slice(0,10):K=String(C??"").trim().slice(0,10);const ne=Xe(k),Me=typeof L=="number"&&!isNaN(L)?L:parseFloat(String(L??"").replace(/,/g,""))||0,Be=typeof A=="number"&&!isNaN(A)?A:parseFloat(String(A??"").replace(/,/g,""))||0,ie=Ze(ae);Q[ie]||(Q[ie]=[]),Q[ie].push({date:K,fuelPrice:ne,fuelLitres:Me,odometerKm:Be})}for(const[p,i]of Object.entries(Q))i.length>0&&y.push({vehicleName:p,entries:i});if(y.length===0)throw new Error("No valid data rows found. Ensure columns: Date, Fuel Price, Fuel Litres, Odometer (km), Vehicle.");const we=I();if(!we)throw new Error("API URL not set");const Ce=50,Se=[];for(const p of y)for(let i=0;i<p.entries.length;i+=Ce)Se.push({vehicleName:p.vehicleName,entries:p.entries.slice(i,i+Ce)});let Fe=0;const re=[];for(const p of Se){const i=JSON.stringify({imports:[p]}),C=await _(`${we}/vehicles-expenses/import`,{method:"POST",headers:{"Content-Type":"application/json"},body:i}),k=await C.text();if(!C.ok){const A=(()=>{try{return JSON.parse(k)}catch{return{}}})(),ae=A.error,K=A.errors,ne=C.status===500&&k?`Import failed (500): ${k.slice(0,300)}${k.length>300?"…":""}`:`Import failed (${C.status})`;throw new Error(ae||(K!=null&&K.length?K.join("; "):null)||ne)}const L=JSON.parse(k);Fe+=L.created??0,(L.errors??[]).length&&re.push(...L.errors)}ue(`Imported ${Fe} entries.${re.length?` Errors: ${re.join("; ")}`:""}`),le(),a&&Y(a)}catch(r){N(r instanceof Error?r.message:"Import failed")}finally{me(!1),t.target.value=""}}};if(!c)return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-slate-100",children:"Vehicles Expenses"}),e.jsx("p",{className:"text-slate-400",children:"Sign in to access your vehicle expenses."})]});if(!x)return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-slate-100",children:"Vehicles Expenses"}),e.jsx("p",{className:"text-slate-400",children:"You need to be in the expenses group to access this section. Contact an admin to be added."})]});const Ie=[...b.map(t=>({id:t.id,label:t.name||"Unnamed"})),{id:"__add__",label:"+ Add vehicle"}],Re=D?"__add__":a??"__add__";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-slate-100",children:"Vehicles Expenses"}),e.jsx("p",{className:"text-slate-400 mt-1",children:"Track fuel costs per vehicle. Data is private to you."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:w,type:"file",accept:".csv,.xlsx,.xls",className:"hidden",onChange:_e}),e.jsx("button",{onClick:()=>{var t;return(t=w.current)==null?void 0:t.click()},disabled:de,className:"rounded-md border border-slate-600 bg-slate-800 px-4 py-2 text-sm text-slate-200 hover:bg-slate-700 disabled:opacity-50",children:de?"Importing…":"Import from CSV/Excel"}),e.jsx("button",{type:"button",onClick:()=>Pe(t=>!t),className:"text-sm text-slate-400 hover:text-slate-200",children:pe?"Hide format":"Import format"})]})]}),pe&&e.jsxs("div",{className:"rounded-lg border border-slate-700 bg-slate-900/50 p-4 text-sm text-slate-300 space-y-2",children:[e.jsx("p",{className:"font-medium text-slate-200",children:"CSV / Excel import format"}),e.jsxs("p",{children:["Use columns: ",e.jsx("strong",{children:"Date"})," (YYYY-MM-DD), ",e.jsx("strong",{children:"Fuel Price"})," ($), ",e.jsx("strong",{children:"Fuel Litres"}),", ",e.jsx("strong",{children:"Odometer (km)"}),", ",e.jsx("strong",{children:"Vehicle"}),". First row = headers. CSV or Excel (.xlsx, .xls) supported."]})]}),W&&e.jsx("div",{className:"rounded-md border border-red-500/60 bg-red-500/10 px-3 py-2 text-sm text-red-200",children:W}),xe&&e.jsx("div",{className:"rounded-md border border-green-500/60 bg-green-500/10 px-3 py-2 text-sm text-green-200",children:xe}),e.jsx(We,{tabs:Ie,activeId:Re,onSelect:t=>{t==="__add__"?(te(!0),f(null)):(te(!1),f(t))}}),D?e.jsxs("div",{className:"rounded-lg border border-slate-700 bg-slate-900/50 p-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-300 mb-3",children:"Add vehicle"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Vehicle name",value:se,onChange:t=>ce(t.target.value),className:"rounded-md border border-slate-600 bg-slate-800 px-3 py-2 text-slate-100 placeholder-slate-500 flex-1"}),e.jsx("button",{onClick:De,disabled:u||!se.trim(),className:"rounded-md bg-primary-500 px-4 py-2 text-sm font-medium text-white hover:bg-primary-600 disabled:opacity-50",children:u?"Adding…":"Add"})]})]}):a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-lg border border-slate-700 bg-slate-900/50 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:q===a?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:z,onChange:t=>B(t.target.value),onKeyDown:t=>{t.key==="Enter"&&be(a,z),t.key==="Escape"&&(X(null),B(""))},placeholder:"Vehicle name",className:"rounded-md border border-slate-600 bg-slate-800 px-3 py-1.5 text-slate-100 placeholder-slate-500 w-48",autoFocus:!0}),e.jsx("button",{onClick:()=>be(a,z),disabled:u||!z.trim(),className:"text-sm text-primary-400 hover:text-primary-300",children:"Save"}),e.jsx("button",{onClick:()=>{X(null),B("")},className:"text-sm text-slate-400 hover:text-slate-200",children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-300",children:((ye=b.find(t=>t.id===a))==null?void 0:ye.name)||"Vehicle"}),e.jsx("button",{onClick:()=>{var t;X(a),B(((t=b.find(s=>s.id===a))==null?void 0:t.name)||"")},disabled:u,className:"text-xs text-slate-400 hover:text-slate-200",children:"Rename"})]})}),e.jsx("button",{onClick:()=>Ae(a),disabled:u,className:"text-sm text-red-400 hover:text-red-300",children:"Delete vehicle"})]}),e.jsx("h2",{className:"text-sm font-semibold text-slate-300 mb-3",children:"Add fuel expense"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("input",{type:"date",value:V.date,onChange:t=>G(s=>({...s,date:t.target.value})),className:"rounded-md border border-slate-600 bg-slate-800 px-3 py-2 text-slate-100"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Fuel price ($)",value:V.fuelPrice,onChange:t=>G(s=>({...s,fuelPrice:t.target.value})),className:"rounded-md border border-slate-600 bg-slate-800 px-3 py-2 text-slate-100 placeholder-slate-500"}),e.jsx("input",{type:"number",step:"0.001",placeholder:"Fuel litres",value:V.fuelLitres,onChange:t=>G(s=>({...s,fuelLitres:t.target.value})),className:"rounded-md border border-slate-600 bg-slate-800 px-3 py-2 text-slate-100 placeholder-slate-500"}),e.jsx("input",{type:"number",step:"1",placeholder:"Odometer (km)",value:V.odometerKm,onChange:t=>G(s=>({...s,odometerKm:t.target.value})),className:"rounded-md border border-slate-600 bg-slate-800 px-3 py-2 text-slate-100 placeholder-slate-500"})]}),e.jsx("button",{onClick:Oe,disabled:u||!V.fuelPrice||!V.fuelLitres||!V.odometerKm,className:"mt-3 rounded-md bg-primary-500 px-4 py-2 text-sm font-medium text-white hover:bg-primary-600 disabled:opacity-50",children:u?"Adding…":"Add fuel entry"})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700 bg-slate-800/50 overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>Ve(t=>!t),className:"w-full flex items-center justify-between px-4 py-3 text-left hover:bg-slate-700/30 transition-colors",children:[e.jsx("span",{className:"text-sm font-medium text-slate-200",children:"Limit results"}),e.jsx("span",{className:"text-slate-400",children:he?"▼":"▶"})]}),he&&e.jsxs("div",{className:"px-4 pb-4 pt-1 border-t border-slate-700 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-500 mb-1",children:"Start date"}),e.jsx("input",{type:"date",value:O.startDate,onChange:t=>T(s=>({...s,startDate:t.target.value})),className:"w-full rounded-md border border-slate-600 bg-slate-800 px-3 py-2 text-sm text-slate-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-500 mb-1",children:"End date"}),e.jsx("input",{type:"date",value:O.endDate,onChange:t=>T(s=>({...s,endDate:t.target.value})),className:"w-full rounded-md border border-slate-600 bg-slate-800 px-3 py-2 text-sm text-slate-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-500 mb-1",children:"Sort order"}),e.jsxs("select",{value:O.sortNewestFirst?"newest":"oldest",onChange:t=>T(s=>({...s,sortNewestFirst:t.target.value==="newest"})),className:"w-full rounded-md border border-slate-600 bg-slate-800 px-3 py-2 text-sm text-slate-100",children:[e.jsx("option",{value:"newest",children:"Newest first"}),e.jsx("option",{value:"oldest",children:"Oldest first"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsx("div",{className:"flex gap-2 items-end",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs text-slate-500 mb-1",children:"Fuel price ($)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:O.fuelPriceOp,onChange:t=>T(s=>({...s,fuelPriceOp:t.target.value})),className:"rounded-md border border-slate-600 bg-slate-800 px-2 py-2 text-sm text-slate-100",children:[e.jsx("option",{value:"higher",children:"Higher than"}),e.jsx("option",{value:"lower",children:"Lower than"})]}),e.jsx("input",{type:"number",step:"0.01",placeholder:"e.g. 50",value:O.fuelPriceVal,onChange:t=>T(s=>({...s,fuelPriceVal:t.target.value})),className:"flex-1 rounded-md border border-slate-600 bg-slate-800 px-3 py-2 text-sm text-slate-100 placeholder-slate-500"})]})]})}),e.jsx("div",{className:"flex gap-2 items-end",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs text-slate-500 mb-1",children:"$/L"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:O.pricePerLOp,onChange:t=>T(s=>({...s,pricePerLOp:t.target.value})),className:"rounded-md border border-slate-600 bg-slate-800 px-2 py-2 text-sm text-slate-100",children:[e.jsx("option",{value:"higher",children:"Higher than"}),e.jsx("option",{value:"lower",children:"Lower than"})]}),e.jsx("input",{type:"number",step:"0.001",placeholder:"e.g. 1.50",value:O.pricePerLVal,onChange:t=>T(s=>({...s,pricePerLVal:t.target.value})),className:"flex-1 rounded-md border border-slate-600 bg-slate-800 px-3 py-2 text-sm text-slate-100 placeholder-slate-500"})]})]})})]})]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700 bg-slate-800/50 overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>$e(t=>!t),className:"w-full flex items-center justify-between px-4 py-3 text-left hover:bg-slate-700/30 transition-colors",children:[e.jsx("span",{className:"text-sm font-medium text-slate-200",children:"Display graph"}),e.jsx("span",{className:"text-slate-400",children:fe?"▼":"▶"})]}),fe&&e.jsx("div",{className:"px-4 pb-4 pt-4 border-t border-slate-700",children:e.jsx("div",{className:"rounded-lg border border-slate-600 bg-slate-900/50 p-4 min-h-[200px]",children:U.length<2?e.jsx("p",{className:"text-slate-500 text-sm py-8 text-center",children:"Add at least 2 fuel entries to display the graph."}):(()=>{const t=[...U].reverse(),s=t.map((l,d)=>{const n=d>0?t[d-1]:null,r=oe(l,n);return{date:l.date??"",pricePerLitre:r.pricePerLitre,lPer100km:r.lPer100km}});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ee,{data:s,valueKey:"pricePerLitre",label:"$/L (cost per litre)",formatValue:l=>`$${l.toFixed(4)}`,color:"rgb(99 102 241)"}),e.jsx(Ee,{data:s,valueKey:"lPer100km",label:"L/100km (fuel efficiency)",formatValue:l=>l.toFixed(2),color:"rgb(34 197 94)"})]})})()})})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700 bg-slate-900/50 overflow-hidden",children:[e.jsxs("h2",{className:"text-sm font-semibold text-slate-300 px-4 py-3 border-b border-slate-700",children:["Fuel expenses (",O.sortNewestFirst?"newest first":"oldest first",")",U.length!==o.length&&e.jsxs("span",{className:"font-normal text-slate-500 ml-2",children:["(",U.length," of ",o.length,")"]})]}),ee?e.jsx("div",{className:"p-8 text-center text-slate-500",children:"Loading…"}):U.length===0?e.jsx("div",{className:"p-8 text-center text-slate-500",children:o.length===0?"No fuel entries yet. Add one above.":"No entries match the current filters. Adjust or clear filters."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-400 uppercase",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"Fuel price"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"Volume"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"$/L"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"L/100km"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"MPG"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"Odometer"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"Distance"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:U.map((t,s)=>{const l=U[s+1]??null,{pricePerLitre:d,distanceKm:n,lPer100km:r,mpg:g}=oe(t,l),F=ke===t.id;return e.jsx("tr",{className:"hover:bg-slate-800/50",children:F?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"date",value:P.date,onChange:y=>Z(h=>({...h,date:y.target.value})),onKeyDown:y=>{y.key==="Enter"&&Ne(t.id),y.key==="Escape"&&J(null)},className:"rounded border border-slate-600 bg-slate-800 px-2 py-1 text-sm text-slate-100 w-36"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",step:"0.01",value:P.fuelPrice,onChange:y=>Z(h=>({...h,fuelPrice:y.target.value})),className:"rounded border border-slate-600 bg-slate-800 px-2 py-1 text-sm text-slate-100 w-20 text-right"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",step:"0.001",value:P.fuelLitres,onChange:y=>Z(h=>({...h,fuelLitres:y.target.value})),className:"rounded border border-slate-600 bg-slate-800 px-2 py-1 text-sm text-slate-100 w-20 text-right"})}),e.jsx("td",{className:"px-4 py-2 text-sm text-slate-500",children:"—"}),e.jsx("td",{className:"px-4 py-2 text-sm text-slate-500",children:"—"}),e.jsx("td",{className:"px-4 py-2 text-sm text-slate-500",children:"—"}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",step:"1",value:P.odometerKm,onChange:y=>Z(h=>({...h,odometerKm:y.target.value})),placeholder:"Odometer",className:"rounded border border-slate-600 bg-slate-800 px-2 py-1 text-sm text-slate-100 w-24 text-right"})}),e.jsx("td",{className:"px-4 py-2 text-sm text-slate-500",children:"—"}),e.jsxs("td",{className:"px-4 py-2 text-right",children:[e.jsx("button",{onClick:()=>Ne(t.id),disabled:u||!P.date||!P.fuelPrice||!P.fuelLitres||!P.odometerKm,className:"text-primary-400 hover:text-primary-300 text-sm mr-2",children:"Save"}),e.jsx("button",{onClick:()=>{J(null)},disabled:u,className:"text-slate-400 hover:text-slate-200 text-sm mr-2",children:"Cancel"}),e.jsx("button",{onClick:()=>je(t.id),disabled:u,className:"text-red-400 hover:text-red-300 text-sm",children:"Delete"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-slate-200",children:qe(t.date)}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-slate-300",children:["$",(t.fuelPrice??t.fuel_price??0).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-slate-300",children:[(t.fuelLitres??0).toLocaleString(void 0,{minimumFractionDigits:3}),"L"]}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-slate-300",children:d!=null?`$${d.toLocaleString(void 0,{minimumFractionDigits:4})}/L`:"—"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-slate-300",children:r!=null?r.toFixed(2):"—"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-slate-300",children:g!=null?g.toFixed(1):"—"}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-slate-300",children:[(t.odometerKm??0).toLocaleString()," km"]}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-slate-300",children:n>0?`${n.toLocaleString()} km`:"—"}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx("button",{onClick:()=>{J(t.id),Z({date:t.date??"",fuelPrice:String(t.fuelPrice??t.fuel_price??""),fuelLitres:String(t.fuelLitres??""),odometerKm:String(t.odometerKm??"")})},disabled:u,className:"text-slate-400 hover:text-slate-200 text-sm mr-2",children:"Edit"}),e.jsx("button",{onClick:()=>je(t.id),disabled:u,className:"text-red-400 hover:text-red-300 text-sm",children:"Delete"})]})]})},t.id)})})]})})]})]}):R?e.jsx("div",{className:"p-8 text-center text-slate-500",children:"Loading vehicles…"}):b.length===0?e.jsx("div",{className:"rounded-lg border border-slate-700 bg-slate-900/50 p-8 text-center text-slate-500",children:'No vehicles yet. Click "+ Add vehicle" to create one.'}):null]})};export{tt as default};
