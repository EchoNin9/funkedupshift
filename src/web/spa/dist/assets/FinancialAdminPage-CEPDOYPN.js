import{u as R,a as U,r as t,c as A,o as M,j as s,L as $}from"./index-DYvV5D9I.js";import{A as N}from"./AdminPageHeader-DGBmdOnC.js";import{A as I}from"./AdminTabs-D8VMsYk5.js";import"./ArrowLeftIcon-Cigvgpax.js";function k(){if(typeof window>"u")return null;const r=window.API_BASE_URL;return r?r.replace(/\/$/,""):null}const H=()=>{const{user:r}=R(),[F,C]=U(),o=F.get("tab"),E=o==="members"?"members":o==="symbols"?"symbols":"overview",[l,i]=t.useState(E),[c,m]=t.useState([]),[u,x]=t.useState("yahoo"),[P,y]=t.useState(!1),[p,h]=t.useState(!1),[f,d]=t.useState(null),[g,v]=t.useState(null),[b,j]=t.useState(""),[T]=t.useState(["yahoo","alpha_vantage"]);t.useEffect(()=>{i(o==="members"?"members":o==="symbols"?"symbols":"overview")},[o]);const D=e=>{i(e),C(e==="overview"?{}:{tab:e},{replace:!0})},S=t.useCallback(async()=>{const e=k();if(e){y(!0),d(null);try{const a=await A(`${e}/admin/financial/default-symbols`);if(!a.ok)throw new Error("Failed to load");const n=await a.json();m(n.symbols??[]),x(n.source??"yahoo")}catch(a){d((a==null?void 0:a.message)??"Failed to load")}finally{y(!1)}}},[]);t.useEffect(()=>{l==="symbols"&&S()},[l,S]);const w=()=>{const e=b.trim().toUpperCase();!e||c.includes(e)||(m(a=>[...a,e]),j(""))},L=e=>{m(a=>a.filter(n=>n!==e))},B=async()=>{const e=k();if(e){h(!0),d(null),v(null);try{const a=await A(`${e}/admin/financial/default-symbols`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({symbols:c,source:u})});if(!a.ok){const n=await a.json().catch(()=>({}));throw new Error(n.error??"Failed to save")}v("Default symbols saved.")}catch(a){d((a==null?void 0:a.message)??"Failed to save")}finally{h(!1)}}};return M(r)?s.jsxs("div",{className:"space-y-6",children:[s.jsx(N,{title:"Financial Admin",description:"Manage Financial section settings, members, and data sources.",actions:s.jsx($,{to:"/financial",className:"btn-secondary text-sm !px-4 !py-2",children:"View Financial"})}),s.jsx(I,{tabs:[{id:"overview",label:"Overview"},{id:"symbols",label:"Tracked Symbols"},{id:"members",label:"Members"}],activeId:l,onSelect:e=>D(e)}),l==="overview"&&s.jsxs("div",{className:"rounded-xl border border-slate-800 bg-slate-950/60 p-6 text-sm text-slate-400",children:[s.jsx("p",{className:"mb-2",children:"Admin configuration:"}),s.jsxs("ul",{className:"list-disc list-inside space-y-1 text-slate-500",children:[s.jsxs("li",{children:[s.jsx("strong",{children:"Tracked symbols"})," – Default symbols for new users' watchlists"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Data source"})," – Yahoo Finance (no key) or Alpha Vantage (API key in Terraform)"]})]})]}),l==="symbols"&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex flex-wrap gap-2 items-end",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"newSymbol",className:"block text-xs text-slate-500 mb-1",children:"Add symbol"}),s.jsx("input",{id:"newSymbol",type:"text",value:b,onChange:e=>j(e.target.value.toUpperCase()),onKeyDown:e=>e.key==="Enter"&&(e.preventDefault(),w()),placeholder:"AAPL",className:"rounded-md border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 w-24"})]}),s.jsx("button",{type:"button",onClick:w,disabled:!b.trim(),className:"rounded-md bg-brand-orange px-3 py-2 text-sm font-medium text-slate-950 hover:bg-orange-500 disabled:opacity-50",children:"Add"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-slate-500 mb-1",children:"Default data source"}),s.jsx("select",{value:u,onChange:e=>x(e.target.value),className:"rounded-md border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50",children:T.map(e=>s.jsx("option",{value:e,children:e==="yahoo"?"Yahoo Finance":"Alpha Vantage"},e))})]}),c.length>0&&s.jsx("ul",{className:"flex flex-wrap gap-2",children:c.map(e=>s.jsxs("li",{className:"inline-flex items-center gap-1 rounded-md bg-slate-800 px-2 py-1 text-sm text-slate-200",children:[e,s.jsx("button",{type:"button",onClick:()=>L(e),className:"text-slate-500 hover:text-red-400","aria-label":`Remove ${e}`,children:"×"})]},e))}),s.jsx("button",{type:"button",onClick:B,disabled:p||P,className:"rounded-md bg-brand-orange px-4 py-2 text-sm font-semibold text-slate-950 hover:bg-orange-500 disabled:opacity-50",children:p?"Saving…":"Save defaults"}),g&&s.jsx("div",{className:"rounded-md border border-emerald-500/60 bg-emerald-500/10 px-3 py-2 text-sm text-emerald-200",children:g}),f&&s.jsx("div",{className:"rounded-md border border-red-500/60 bg-red-500/10 px-3 py-2 text-sm text-red-200",children:f})]}),l==="members"&&s.jsx("div",{className:"rounded-xl border border-slate-800 bg-slate-950/60 p-6 text-sm text-slate-400",children:s.jsx("p",{className:"mb-2",children:"Financial access is RBAC-based: guests view default symbols (session-only custom symbols); logged-in users can save their watchlist. No custom group required."})})]}):s.jsx("div",{className:"space-y-6",children:s.jsx(N,{title:"Financial Admin",description:"SuperAdmin access is required."})})};export{H as default};
