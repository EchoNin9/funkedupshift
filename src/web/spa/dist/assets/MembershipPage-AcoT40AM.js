import{r as a,u as dt,d as ct,a as mt,h as ut,j as e,n as pt,l as xt,F as ht,c as h}from"./index-BHtdhaZ_.js";import{A as Je}from"./AdminPageHeader-dlKsnSEs.js";import"./ArrowLeftIcon-DJQ7xUfc.js";function bt({title:d,titleId:u,...m},p){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:p,"aria-labelledby":u},m),d?a.createElement("title",{id:u},d):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z"}))}const ft=a.forwardRef(bt);function gt({title:d,titleId:u,...m},p){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:p,"aria-labelledby":u},m),d?a.createElement("title",{id:u},d):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z"}))}const jt=a.forwardRef(gt),_={admin:"SuperAdmin",manager:"Manager",user:"User"},Ve=["admin","manager","user"],ne=[{value:-8,label:"UTC-8"},{value:-5,label:"UTC-5"},{value:0,label:"UTC+0/GMT"}];function b(){if(typeof window>"u")return null;const d=window.API_BASE_URL;return d?d.replace(/\/$/,""):null}function yt(d,u,m){if(!d&&!m)return"—";if(!d)return m?`from ${m}`:"—";try{const p=new Date(d);if(isNaN(p.getTime()))return d+(m?` from ${m}`:"");const f=p.getTime()+(u||0)*36e5,g=new Date(f),c=y=>y<10?"0"+y:""+y,j=g.getUTCFullYear(),k=c(g.getUTCMonth()+1),w=c(g.getUTCDate()),q=c(g.getUTCHours()),R=c(g.getUTCMinutes()),N=ne.find(y=>y.value===u),G=N?N.label:u<0?"UTC"+u:"UTC+"+u;let v=`${j}-${k}-${w} ${q}:${R} ${G}`;return m&&(v+=` from ${m}`),v}catch{return d+(m?` from ${m}`:"")}}const St=()=>{var He;const{user:d}=dt(),u=ct(),[m,p]=mt(),f=m.get("tab"),g=f==="groups"?"groups":f==="roles"?"roles":"users",[c,j]=a.useState(g);a.useEffect(()=>{j(f==="groups"?"groups":f==="roles"?"roles":"users")},[f]);const k=t=>{j(t);const s=new URLSearchParams(m);t==="groups"?s.set("tab","groups"):t==="roles"?s.set("tab","roles"):s.delete("tab"),p(s)},[w,q]=a.useState([]),[R,N]=a.useState(!0),[G,v]=a.useState(null),[y,We]=a.useState(""),[re,oe]=a.useState(-8),[E,Z]=a.useState([]),[Ye,A]=a.useState(!0),[le,C]=a.useState(null),[H,ie]=a.useState(""),[de,ce]=a.useState(""),[me,ue]=a.useState(""),[pe,xe]=a.useState(!1),[he,be]=a.useState(null),[U,fe]=a.useState(null),[J,V]=a.useState(""),[ge,W]=a.useState(""),[je,ye]=a.useState(!1),[we,L]=a.useState(null),[D,Ne]=a.useState(null),[ve,Y]=a.useState([]),[Ke,F]=a.useState(!0),[Ce,S]=a.useState(null),[K,Se]=a.useState(""),[X,ke]=a.useState([]),[Q,Re]=a.useState([]),[Ee,Ue]=a.useState(!1),[$e,Te]=a.useState(null),[$,Ge]=a.useState(null),[P,ee]=a.useState([]),[I,te]=a.useState([]),[Ae,Le]=a.useState(!1),[De,M]=a.useState(null),[O,Fe]=a.useState(null),T=ut(d??null,"manager"),B=(d==null?void 0:d.role)==="superadmin",[Xe,z]=a.useState(!1),Pe=async t=>{var n;const s=b();if(!s){v("API URL not set."),N(!1);return}if(!((n=window.auth)!=null&&n.getAccessToken)){v("Sign in required."),N(!1);return}N(!0),v(null);try{let o=`${s}/admin/users`;t&&(o+=`?paginationToken=${encodeURIComponent(t)}`);const r=await h(o);if(!r.ok){const x=await r.json().catch(()=>({}));throw new Error(x.error||"Failed to load users")}const l=await r.json();q(x=>t?[...x,...l.users??[]]:l.users??[]),We(l.paginationToken??"")}catch(o){v((o==null?void 0:o.message)??"Failed to load users")}finally{N(!1)}},Qe=async t=>{const s=b();if(!s)return{cognitoGroups:[],customGroups:[]};try{const i=await h(`${s}/admin/users/${encodeURIComponent(t.username)}/groups`);if(!i.ok)return{cognitoGroups:[],customGroups:[]};const n=await i.json();return{cognitoGroups:n.cognitoGroups??[],customGroups:n.customGroups??[]}}catch{return{cognitoGroups:[],customGroups:[]}}},Ie=async()=>{var i;const t=b();if(!t){C("API URL not set."),A(!1);return}if(!((i=window.auth)!=null&&i.getAccessToken)){C("Sign in required."),A(!1);return}A(!0),C(null);try{const n=await h(`${t}/admin/groups`);if(!n.ok)throw new Error(await n.text());const r=((await n.json()).groups??[]).map(l=>({name:l.name??(l.PK??"").replace("GROUP#",""),description:l.description,permissions:Array.isArray(l.permissions)?l.permissions:[]}));r.sort((l,x)=>l.name.toLowerCase().localeCompare(x.name.toLowerCase())),Z(r)}catch(n){C((n==null?void 0:n.message)??"Failed to load groups")}finally{A(!1)}};a.useEffect(()=>{const t=parseInt(sessionStorage.getItem("funkedupshift_lastlogin_tz")??"-8",10);!isNaN(t)&&ne.some(s=>s.value===t)&&oe(t)},[]),a.useEffect(()=>{T&&c==="users"&&Pe()},[T,c]),a.useEffect(()=>{T&&(c==="groups"||c==="roles")&&Ie()},[T,c]);const Me=async()=>{var i;const t=b();if(!t){S("API URL not set."),F(!1);return}if(!((i=window.auth)!=null&&i.getAccessToken)){S("Sign in required."),F(!1);return}F(!0),S(null);try{const n=await h(`${t}/admin/roles`);if(!n.ok){const r=await n.json().catch(()=>({}));throw new Error(r.error||"Failed to load roles")}const o=await n.json();Y(o.roles??[])}catch(n){S((n==null?void 0:n.message)??"Failed to load roles")}finally{F(!1)}};a.useEffect(()=>{B&&c==="roles"&&Me()},[B,c]);const et=t=>{u(`/admin/users/edit?username=${encodeURIComponent(t.username)}&email=${encodeURIComponent(t.email??"")}&status=${encodeURIComponent(t.status??"")}`)},tt=(t,s)=>{const i=[];return(t||[]).forEach(n=>{const o=_[n]||n,r=n==="admin"?"bg-amber-500/20 text-amber-200":n==="manager"?"bg-blue-500/20 text-blue-200":"bg-slate-600/30 text-slate-300";i.push(e.jsx("span",{className:`inline-block px-2 py-0.5 rounded text-xs mr-1 ${r}`,children:o},`c-${n}`))}),(s||[]).forEach(n=>{i.push(e.jsx("span",{className:"inline-block px-2 py-0.5 rounded text-xs mr-1 bg-emerald-500/20 text-emerald-200",children:n},`x-${n}`))}),i.length?i:e.jsx("span",{className:"text-slate-500",children:"—"})},st=t=>{fe(t.name),V(t.description??""),W((t.permissions??[]).join(", ")),L(null)},se=()=>{fe(null),V(""),W(""),L(null)},at=async t=>{var r;t.preventDefault();const s=H.trim();if(!s)return;const i=b();if(!i||!((r=window.auth)!=null&&r.getAccessToken))return;const o=me.split(",").map(l=>l.trim()).filter(Boolean);xe(!0),be(null),C(null);try{const l=await h(`${i}/admin/groups`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s,description:de.trim(),permissions:o})});if(!l.ok){const x=await l.json().catch(()=>({}));throw new Error(x.error||"Failed to create group")}ie(""),ce(""),ue(""),be("Group created."),Ie()}catch(l){C((l==null?void 0:l.message)??"Failed to create group")}finally{xe(!1)}},nt=async t=>{var o;if(t.preventDefault(),!U)return;const s=b();if(!s||!((o=window.auth)!=null&&o.getAccessToken))return;const n=ge.split(",").map(r=>r.trim()).filter(Boolean);ye(!0),L(null);try{const r=await h(`${s}/admin/groups/${encodeURIComponent(U)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({description:J,permissions:n})});if(!r.ok){const l=await r.json().catch(()=>({}));throw new Error(l.error||"Failed to update group")}Z(l=>l.map(x=>x.name===U?{...x,description:J,permissions:n}:x)),se()}catch(r){L((r==null?void 0:r.message)??"Failed to update group")}finally{ye(!1)}},Oe=async t=>{var n;if(!window.confirm(`Delete group "${t}"? Members will lose access.`))return;const s=b();if(!(!s||!((n=window.auth)!=null&&n.getAccessToken))){Ne(t);try{const o=await h(`${s}/admin/groups/${encodeURIComponent(t)}`,{method:"DELETE"});if(!o.ok){const r=await o.json().catch(()=>({}));throw new Error(r.error||"Failed to delete group")}Z(r=>r.filter(l=>l.name!==t)),U===t&&se()}catch(o){C((o==null?void 0:o.message)??"Failed to delete group")}finally{Ne(null)}}},rt=t=>{const s=parseInt(t.target.value,10);oe(s),sessionStorage.setItem("funkedupshift_lastlogin_tz",String(s))},Be=(t,s,i)=>{s.includes(t)?i(s.filter(n=>n!==t)):i([...s,t])},ze=(t,s,i)=>{s.includes(t)?i(s.filter(n=>n!==t)):i([...s,t])},ot=async t=>{var o;t.preventDefault();const s=K.trim();if(!s)return;const i=b();if(!(!i||!((o=window.auth)!=null&&o.getAccessToken))){Ue(!0),Te(null),S(null);try{const r=await h(`${i}/admin/roles`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s,cognitoGroups:X,customGroups:Q})});if(!r.ok){const l=await r.json().catch(()=>({}));throw new Error(l.error||"Failed to create role")}Se(""),ke([]),Re([]),Te("Role created."),Me()}catch(r){S((r==null?void 0:r.message)??"Failed to create role")}finally{Ue(!1)}}},lt=t=>{Ge(t.name),ee(t.cognitoGroups??[]),te(t.customGroups??[]),M(null)},ae=()=>{Ge(null),ee([]),te([]),M(null)},it=async t=>{var n;if(t.preventDefault(),!$)return;const s=b();if(!(!s||!((n=window.auth)!=null&&n.getAccessToken))){Le(!0),M(null);try{const o=await h(`${s}/admin/roles/${encodeURIComponent($)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({cognitoGroups:P,customGroups:I})});if(!o.ok){const r=await o.json().catch(()=>({}));throw new Error(r.error||"Failed to update role")}Y(r=>r.map(l=>l.name===$?{...l,cognitoGroups:P,customGroups:I}:l)),ae()}catch(o){M((o==null?void 0:o.message)??"Failed to update role")}finally{Le(!1)}}},_e=async t=>{var n;if(!window.confirm(`Delete role "${t}"?`))return;const s=b();if(!(!s||!((n=window.auth)!=null&&n.getAccessToken))){Fe(t);try{const o=await h(`${s}/admin/roles/${encodeURIComponent(t)}`,{method:"DELETE"});if(!o.ok){const r=await o.json().catch(()=>({}));throw new Error(r.error||"Failed to delete role")}Y(r=>r.filter(l=>l.name!==t)),$===t&&ae()}catch(o){S((o==null?void 0:o.message)??"Failed to delete role")}finally{Fe(null)}}};if(!T)return e.jsx("div",{className:"space-y-6",children:e.jsx(Je,{title:"Membership",description:"Manager or SuperAdmin access is required."})});const qe=[{id:"users",label:"Users",icon:pt},{id:"groups",label:"Groups",icon:jt},...B?[{id:"roles",label:"Roles",icon:ft}]:[]],Ze=e.jsx("nav",{className:"flex flex-col gap-0.5 py-2","aria-label":"Custom groups navigation",children:qe.map(t=>e.jsxs("button",{type:"button",onClick:()=>{k(t.id),z(!1)},className:`flex items-center gap-3 px-4 py-2.5 text-sm rounded-r-md transition-colors text-left w-full ${c===t.id?"bg-slate-800 text-primary-400 font-medium border-l-2 border-primary-500 -ml-px":"text-slate-400 hover:bg-slate-800/50 hover:text-slate-200"}`,children:[e.jsx(t.icon,{className:"w-5 h-5 shrink-0"}),t.label]},t.id))});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(Je,{title:"Membership",description:"Manage users and groups."}),e.jsxs("div",{className:"flex min-h-0 flex-1 gap-0",children:[e.jsx("aside",{className:"hidden md:flex md:w-52 md:flex-col md:shrink-0 border-r border-slate-800 bg-slate-950/50 rounded-lg pr-2",children:Ze}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"md:hidden flex items-center gap-2 mb-4",children:[e.jsx("button",{type:"button",onClick:()=>z(!0),className:"min-h-[44px] min-w-[44px] flex items-center justify-center rounded-md text-slate-300 hover:text-white hover:bg-slate-800 transition-colors","aria-label":"Open membership menu",children:e.jsx(xt,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-sm font-medium text-slate-400",children:((He=qe.find(t=>t.id===c))==null?void 0:He.label)??"Menu"})]}),Xe&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40 bg-slate-950/80 backdrop-blur-sm md:hidden","aria-hidden":!0,onClick:()=>z(!1)}),e.jsxs("aside",{className:"fixed top-0 left-0 z-50 w-64 h-full bg-slate-950 border-r border-slate-800 md:hidden overflow-y-auto pt-16","aria-label":"Membership navigation",children:[e.jsx("button",{type:"button",onClick:()=>z(!1),className:"absolute top-4 right-4 p-2 text-slate-400 hover:text-white","aria-label":"Close menu",children:e.jsx(ht,{className:"w-6 h-6"})}),Ze]})]}),e.jsxs("div",{className:"space-y-6",children:[c==="users"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("label",{htmlFor:"tz-select",className:"text-slate-500",children:"Last login timezone:"}),e.jsx("select",{id:"tz-select",value:re,onChange:rt,className:"rounded border border-slate-700 bg-slate-950 px-2 py-1 text-slate-200 text-sm",children:ne.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),G&&e.jsx("div",{className:"rounded-md border border-red-500/60 bg-red-500/10 px-3 py-2 text-sm text-red-200",children:G}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-slate-800",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-800",children:[e.jsx("thead",{className:"bg-slate-900/80",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-400 uppercase",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-400 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-400 uppercase",children:"Last login"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-400 uppercase",children:"System Roles"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-400 uppercase",children:"Custom Groups"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-800",children:R&&w.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-slate-500",children:"Loading…"})}):w.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-slate-500",children:"No users found."})}):w.map(t=>e.jsx(wt,{user:t,tzOffset:re,formatLastLogin:yt,renderGroupBadges:tt,loadUserGroups:Qe,onClick:()=>et(t)},t.username))})]})}),y&&e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",onClick:()=>Pe(y),disabled:R,className:"rounded-md border border-slate-700 px-4 py-2 text-sm font-medium text-slate-200 hover:bg-slate-800 disabled:opacity-50",children:R?"Loading…":"Load more"})})]}),c==="groups"&&e.jsxs(e.Fragment,{children:[e.jsxs("form",{className:"space-y-3 max-w-md",onSubmit:at,children:[e.jsx("h2",{className:"text-sm font-medium text-slate-300",children:"Create group"}),e.jsx("input",{type:"text",value:H,onChange:t=>ie(t.target.value),placeholder:"Name (alphanumeric, underscore, hyphen)",required:!0,className:"w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 focus:border-brand-orange focus:outline-none focus:ring-1 focus:ring-brand-orange"}),e.jsx("input",{type:"text",value:de,onChange:t=>ce(t.target.value),placeholder:"Description (optional)",className:"w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 focus:border-brand-orange focus:outline-none focus:ring-1 focus:ring-brand-orange"}),e.jsx("input",{type:"text",value:me,onChange:t=>ue(t.target.value),placeholder:"Permissions (comma-separated, e.g. media:edit, sites:add)",className:"w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 focus:border-brand-orange focus:outline-none focus:ring-1 focus:ring-brand-orange"}),e.jsx("button",{type:"submit",disabled:pe||!H.trim(),className:"inline-flex items-center justify-center rounded-md bg-brand-orange px-4 py-2 text-sm font-semibold text-slate-950 hover:bg-orange-500 disabled:opacity-50",children:pe?"Creating…":"Create"}),he&&e.jsx("div",{className:"rounded-md border border-emerald-500/60 bg-emerald-500/10 px-3 py-2 text-sm text-emerald-200",children:he}),le&&e.jsx("div",{className:"rounded-md border border-red-500/60 bg-red-500/10 px-3 py-2 text-sm text-red-200",children:le})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-medium text-slate-300 mb-2",children:"Custom groups"}),Ye?e.jsx("p",{className:"text-sm text-slate-500",children:"Loading…"}):E.length===0?e.jsx("p",{className:"text-sm text-slate-500",children:"No custom groups yet. Create one above."}):e.jsx("ul",{className:"space-y-2",children:E.map(t=>e.jsx("li",{className:"rounded-lg border border-slate-800 bg-slate-950/60 px-3 py-2 text-sm",children:U===t.name?e.jsxs("form",{onSubmit:nt,className:"space-y-2",children:[e.jsx("span",{className:"font-medium text-slate-200",children:t.name}),e.jsx("input",{type:"text",value:J,onChange:s=>V(s.target.value),placeholder:"Description (optional)",className:"w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 focus:border-brand-orange focus:outline-none focus:ring-1 focus:ring-brand-orange"}),e.jsx("input",{type:"text",value:ge,onChange:s=>W(s.target.value),placeholder:"Permissions (comma-separated)",className:"w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 focus:border-brand-orange focus:outline-none focus:ring-1 focus:ring-brand-orange"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("button",{type:"submit",disabled:je,className:"rounded-md bg-brand-orange px-3 py-1.5 text-xs font-medium text-slate-950 hover:bg-orange-500 disabled:opacity-50",children:je?"Saving…":"Save"}),e.jsx("button",{type:"button",onClick:se,className:"rounded-md border border-slate-700 px-3 py-1.5 text-xs font-medium text-slate-300 hover:bg-slate-800",children:"Cancel"}),e.jsx("button",{type:"button",onClick:()=>Oe(t.name),disabled:D===t.name,className:"rounded-md border border-red-500/60 px-3 py-1.5 text-xs font-medium text-red-400 hover:bg-red-500/20 disabled:opacity-50",children:D===t.name?"Deleting…":"Delete"})]}),we&&e.jsx("p",{className:"text-xs text-red-400",children:we})]}):e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"font-medium text-slate-200",children:t.name}),t.description&&e.jsx("span",{className:"text-slate-500 ml-2",children:t.description}),t.permissions&&t.permissions.length>0&&e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Permissions: ",t.permissions.join(", ")]})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>st(t),className:"rounded-md border border-slate-700 px-2 py-1 text-xs font-medium text-slate-300 hover:bg-slate-800",children:"Edit"}),e.jsx("button",{type:"button",onClick:()=>Oe(t.name),disabled:D===t.name,className:"rounded-md border border-red-500/60 px-2 py-1 text-xs font-medium text-red-400 hover:bg-red-500/20 disabled:opacity-50",children:D===t.name?"Deleting…":"Delete"})]})]})},t.name))})]})]}),c==="roles"&&B&&e.jsxs(e.Fragment,{children:[e.jsxs("form",{className:"space-y-3 max-w-md",onSubmit:ot,children:[e.jsx("h2",{className:"text-sm font-medium text-slate-300",children:"Create role"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Define a named role by selecting Cognito groups and custom groups. Use for impersonation."}),e.jsx("input",{type:"text",value:K,onChange:t=>Se(t.target.value),placeholder:"Role name (e.g. Squash Manager)",required:!0,className:"w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 focus:border-brand-orange focus:outline-none focus:ring-1 focus:ring-brand-orange"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Cognito groups"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Ve.map(t=>e.jsx("button",{type:"button",onClick:()=>Be(t,X,ke),className:`rounded-md px-2 py-1 text-xs font-medium ${X.includes(t)?"bg-blue-500/30 text-blue-200":"border border-slate-600 text-slate-400 hover:bg-slate-800"}`,children:_[t]||t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Custom groups"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[E.map(t=>e.jsx("button",{type:"button",onClick:()=>ze(t.name,Q,Re),className:`rounded-md px-2 py-1 text-xs font-medium ${Q.includes(t.name)?"bg-emerald-500/30 text-emerald-200":"border border-slate-600 text-slate-400 hover:bg-slate-800"}`,children:t.name},t.name)),E.length===0&&e.jsx("span",{className:"text-xs text-slate-500",children:"Create groups first."})]})]}),e.jsx("button",{type:"submit",disabled:Ee||!K.trim(),className:"inline-flex items-center justify-center rounded-md bg-brand-orange px-4 py-2 text-sm font-semibold text-slate-950 hover:bg-orange-500 disabled:opacity-50",children:Ee?"Creating…":"Create"}),$e&&e.jsx("div",{className:"rounded-md border border-emerald-500/60 bg-emerald-500/10 px-3 py-2 text-sm text-emerald-200",children:$e}),Ce&&e.jsx("div",{className:"rounded-md border border-red-500/60 bg-red-500/10 px-3 py-2 text-sm text-red-200",children:Ce})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-medium text-slate-300 mb-2",children:"Defined roles"}),Ke?e.jsx("p",{className:"text-sm text-slate-500",children:"Loading…"}):ve.length===0?e.jsx("p",{className:"text-sm text-slate-500",children:"No roles yet. Create one above."}):e.jsx("ul",{className:"space-y-2",children:ve.map(t=>e.jsx("li",{className:"rounded-lg border border-slate-800 bg-slate-950/60 px-3 py-2 text-sm",children:$===t.name?e.jsxs("form",{onSubmit:it,className:"space-y-2",children:[e.jsx("span",{className:"font-medium text-slate-200",children:t.name}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-500 mb-1",children:"Cognito groups"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Ve.map(s=>e.jsx("button",{type:"button",onClick:()=>Be(s,P,ee),className:`rounded-md px-2 py-1 text-xs ${P.includes(s)?"bg-blue-500/30 text-blue-200":"border border-slate-600 text-slate-400"}`,children:_[s]||s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-500 mb-1",children:"Custom groups"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:E.map(s=>e.jsx("button",{type:"button",onClick:()=>ze(s.name,I,te),className:`rounded-md px-2 py-1 text-xs ${I.includes(s.name)?"bg-emerald-500/30 text-emerald-200":"border border-slate-600 text-slate-400"}`,children:s.name},s.name))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",disabled:Ae,className:"rounded-md bg-brand-orange px-3 py-1.5 text-xs font-medium text-slate-950 hover:bg-orange-500 disabled:opacity-50",children:Ae?"Saving…":"Save"}),e.jsx("button",{type:"button",onClick:ae,className:"rounded-md border border-slate-700 px-3 py-1.5 text-xs text-slate-300 hover:bg-slate-800",children:"Cancel"}),e.jsx("button",{type:"button",onClick:()=>_e(t.name),disabled:O===t.name,className:"rounded-md border border-red-500/60 px-3 py-1.5 text-xs text-red-400 hover:bg-red-500/20 disabled:opacity-50",children:O===t.name?"Deleting…":"Delete"})]}),De&&e.jsx("p",{className:"text-xs text-red-400",children:De})]}):e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"font-medium text-slate-200",children:t.name}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[(t.cognitoGroups??[]).map(s=>e.jsx("span",{className:"inline-block px-2 py-0.5 rounded text-xs bg-blue-500/20 text-blue-200",children:_[s]||s},`c-${s}`)),(t.customGroups??[]).map(s=>e.jsx("span",{className:"inline-block px-2 py-0.5 rounded text-xs bg-emerald-500/20 text-emerald-200",children:s},`x-${s}`))]})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>lt(t),className:"rounded-md border border-slate-700 px-2 py-1 text-xs text-slate-300 hover:bg-slate-800",children:"Edit"}),e.jsx("button",{type:"button",onClick:()=>_e(t.name),disabled:O===t.name,className:"rounded-md border border-red-500/60 px-2 py-1 text-xs text-red-400 hover:bg-red-500/20 disabled:opacity-50",children:O===t.name?"Deleting…":"Delete"})]})]})},t.name))})]})]})]})]})]})]})},wt=({user:d,tzOffset:u,formatLastLogin:m,renderGroupBadges:p,loadUserGroups:f,onClick:g})=>{const[c,j]=a.useState(null);return a.useEffect(()=>{let k=!1;return f(d).then(w=>{k||j(w)}),()=>{k=!0}},[d.username]),e.jsxs("tr",{className:"cursor-pointer hover:bg-slate-800/50 transition-colors",onClick:g,children:[e.jsx("td",{className:"px-4 py-3 text-sm text-slate-200",children:d.email||d.username||"—"}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-400",children:d.status||"—"}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-400",children:m(d.lastLoginAt??"",u,d.lastLoginIp)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:c?p(c.cognitoGroups,[]):e.jsx("span",{className:"text-slate-500",children:"…"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:c?p([],c.customGroups):e.jsx("span",{className:"text-slate-500",children:"…"})})]})};export{St as default};
