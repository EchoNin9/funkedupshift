import{u as W,n as q,o as D,r as n,f as I,c as R,j as e,L as J}from"./index-CqR0r56c.js";function b(){if(typeof window>"u")return null;const l=window.API_BASE_URL;return l?l.replace(/\/$/,""):null}const y="funkedupshift_financial_guest_symbols",Y=()=>{const{user:l}=W(),i=q(l),U=D(l),[o,d]=n.useState([]),[L,h]=n.useState({}),[x,g]=n.useState("yahoo"),[f,P]=n.useState([]),[_,j]=n.useState(!0),[S,v]=n.useState(!1),[u,w]=n.useState(""),[N,m]=n.useState(null),[A,k]=n.useState(null),F=n.useCallback(async()=>{const t=b();if(t){j(!0),m(null);try{const s=await I(`${t}/financial/config`),a=s.ok?await s.json():{symbols:[],source:"yahoo",availableSources:["yahoo"]},c=a.symbols??[];if(g(a.source??"yahoo"),P(a.availableSources??["yahoo"]),i&&(l!=null&&l.userId)){const r=await R(`${t}/financial/watchlist`);if(r.ok){const $=(await r.json()).symbols??[];d($.length>0?$:c)}else d(c)}else{const r=(()=>{try{const p=sessionStorage.getItem(y);return p?JSON.parse(p):[]}catch{return[]}})();d(r.length>0?r:c)}}catch(s){m((s==null?void 0:s.message)??"Failed to load watchlist")}finally{j(!1)}}},[i,l==null?void 0:l.userId]),C=n.useCallback(async()=>{const t=b();if(!t||o.length===0)return;const s={};for(const a of o)try{const c=await I(`${t}/financial/quote?symbol=${encodeURIComponent(a)}&source=${encodeURIComponent(x)}`);if(c.ok){const r=await c.json();s[a]=r}else s[a]=null}catch{s[a]=null}h(s)},[o,x]);n.useEffect(()=>{F()},[F]),n.useEffect(()=>{o.length>0?C():h({})},[o,x,C]);const E=()=>{const t=u.trim().toUpperCase();!t||o.includes(t)||(d(s=>{const a=[...s,t];if(!i)try{sessionStorage.setItem(y,JSON.stringify(a))}catch{}return a}),w(""))},B=t=>{d(s=>{const a=s.filter(c=>c!==t);if(!i)try{sessionStorage.setItem(y,JSON.stringify(a))}catch{}return a}),h(s=>{const a={...s};return delete a[t],a})},O=async()=>{const t=b();if(t){v(!0),m(null),k(null);try{const s=await R(`${t}/financial/watchlist`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({symbols:o})});if(!s.ok){const a=await s.json().catch(()=>({}));throw new Error(a.error??"Failed to save")}k("Watchlist saved.")}catch(s){m((s==null?void 0:s.message)??"Failed to save")}finally{v(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-xl font-semibold text-slate-100",children:"Financial"}),U&&e.jsx("p",{className:"text-sm text-slate-400",children:e.jsx(J,{to:"/admin/financial",className:"text-brand-orange hover:text-orange-400",children:"Financial Admin"})}),_?e.jsx("p",{className:"text-sm text-slate-500",children:"Loading…"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap gap-2 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newSymbol",className:"block text-xs text-slate-500 mb-1",children:"Add symbol"}),e.jsx("input",{id:"newSymbol",type:"text",value:u,onChange:t=>w(t.target.value.toUpperCase()),onKeyDown:t=>t.key==="Enter"&&(t.preventDefault(),E()),placeholder:"AAPL",className:"rounded-md border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 w-24"})]}),e.jsx("button",{type:"button",onClick:E,disabled:!u.trim(),className:"rounded-md bg-brand-orange px-3 py-2 text-sm font-medium text-slate-950 hover:bg-orange-500 disabled:opacity-50",children:"Add"}),f.length>1&&e.jsxs("div",{className:"ml-4",children:[e.jsx("label",{className:"block text-xs text-slate-500 mb-1",children:"Data source"}),e.jsx("select",{value:x,onChange:t=>g(t.target.value),className:"rounded-md border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50",children:f.map(t=>e.jsx("option",{value:t,children:t==="yahoo"?"Yahoo Finance":"Alpha Vantage"},t))})]})]}),o.length>0&&e.jsx("div",{className:"rounded-xl border border-slate-800 bg-slate-950/60 overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-800",children:[e.jsx("thead",{className:"bg-slate-900/80",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-400 uppercase",children:"Symbol"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"Change"}),e.jsx("th",{className:"px-4 py-3 w-10"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-800",children:o.map(t=>{const s=L[t];return e.jsxs("tr",{className:"hover:bg-slate-800/50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-slate-200",children:t}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-slate-300",children:s?`$${s.price.toFixed(2)}`:"—"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:s?e.jsxs("span",{className:s.change>=0?"text-emerald-400":"text-red-400",children:[s.change>=0?"+":"",s.change.toFixed(2)," (",s.changePercent>=0?"+":"",s.changePercent.toFixed(2),"%)"]}):e.jsx("span",{className:"text-slate-500",children:"—"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{type:"button",onClick:()=>B(t),className:"text-slate-500 hover:text-red-400","aria-label":`Remove ${t}`,children:"×"})})]},t)})})]})}),i&&o.length>0&&e.jsx("button",{type:"button",onClick:O,disabled:S,className:"rounded-md bg-brand-orange px-4 py-2 text-sm font-semibold text-slate-950 hover:bg-orange-500 disabled:opacity-50",children:S?"Saving…":"Save watchlist"}),!i&&e.jsx("p",{className:"text-sm text-slate-500",children:"Sign in to save your watchlist. Guest symbols are temporary and expire when you close the browser."}),o.length===0&&e.jsx("p",{className:"text-sm text-slate-500",children:"Add symbols above to build your watchlist. Default symbols from admin may appear when you first load."})]}),A&&e.jsx("div",{className:"rounded-md border border-emerald-500/60 bg-emerald-500/10 px-3 py-2 text-sm text-emerald-200",children:A}),N&&e.jsx("div",{className:"rounded-md border border-red-500/60 bg-red-500/10 px-3 py-2 text-sm text-red-200",children:N})]})};export{Y as default};
