import{r,j as s}from"./index-CqR0r56c.js";const D=({tags:l,onTagsChange:h,allTags:d,fetchTags:a,placeholder:v="Type to suggest or create tag, Tab to autocomplete",className:w=""})=>{const[n,g]=r.useState(""),[y,i]=r.useState(!1),[m,u]=r.useState(0),[p,c]=r.useState(null),x=r.useRef(null),k=r.useRef(null),b=r.useRef(null);r.useEffect(()=>{function e(t){b.current&&!b.current.contains(t.target)&&i(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),r.useEffect(()=>{if(!a){c(null);return}const e=n.trim();if(e.length===0){c(null);return}x.current&&x.current.abort();const t=new AbortController;x.current=t;const E=setTimeout(()=>{a(e).then(N=>{t.signal.aborted||c(N)}).catch(()=>{t.signal.aborted||c(null)})},80);return()=>{clearTimeout(E),t.abort()}},[n,a]);const o=r.useMemo(()=>{const e=n.trim().toLowerCase();return a&&p!==null?p.filter(t=>!l.includes(t)):e?d.filter(t=>!l.includes(t)&&t.toLowerCase().includes(e)):d.filter(t=>!l.includes(t))},[d,l,n,a,p]),f=e=>{const t=e.trim();t&&!l.includes(t)&&h([...l,t]),g(""),u(0)},j=e=>{h(l.filter(t=>t!==e))},C=e=>{if(e.key==="Tab"||e.key==="Enter"){if(e.preventDefault(),o.length>0)f(o[m]??o[0]);else{const t=n.trim();t&&f(t)}return}if(e.key==="ArrowDown"){e.preventDefault(),u(t=>(t+1)%Math.max(1,o.length));return}if(e.key==="ArrowUp"){e.preventDefault(),u(t=>t<=0?Math.max(0,o.length-1):t-1);return}e.key==="Escape"&&(i(!1),u(0))};return s.jsxs("div",{ref:b,className:`relative ${w}`,children:[s.jsx("input",{ref:k,type:"text",value:n,onChange:e=>{g(e.target.value),i(!0),u(0)},onFocus:()=>i(!0),onKeyDown:C,placeholder:v,className:"w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 placeholder:text-slate-500 focus:border-brand-orange focus:outline-none focus:ring-1 focus:ring-brand-orange",autoComplete:"off"}),y&&(o.length>0||n.trim())&&s.jsx("div",{className:"absolute left-0 top-full z-10 mt-1 w-full max-h-48 overflow-auto rounded-md border border-slate-700 bg-slate-900 shadow-lg",role:"listbox",children:o.length>0?o.map((e,t)=>s.jsx("button",{type:"button",role:"option","aria-selected":t===m,onClick:()=>f(e),onMouseEnter:()=>u(t),className:`block w-full text-left px-3 py-2 text-sm text-slate-200 hover:bg-slate-800 ${t===m?"bg-slate-800":""}`,children:e},e)):s.jsxs("button",{type:"button",onClick:()=>n.trim()&&f(n.trim()),className:"block w-full text-left px-3 py-2 text-sm text-slate-200 hover:bg-slate-800",children:['Create "',n.trim(),'"']})}),l.length>0&&s.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:l.map(e=>s.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-slate-800 px-2 py-0.5 text-xs text-slate-300",children:[e,s.jsx("button",{type:"button",onClick:()=>j(e),className:"hover:text-slate-100","aria-label":`Remove ${e}`,children:"Ã—"})]},e))})]})};export{D as A};
