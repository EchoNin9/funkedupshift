import{u as y,r as l,f as k,h as A,j as e,L as h,_ as v,F as E}from"./index-RrEZtQ9C.js";import{F as I}from"./StarIcon-ClABU_MW.js";function L(){if(typeof window>"u")return null;const o=window.API_BASE_URL;return!o||o==="API_URL_PLACEHOLDER"||!o.startsWith("http")?null:o.replace(/\/$/,"")}const C=()=>{const{user:o}=y(),[i,p]=l.useState([]),[d,c]=l.useState(null),[g,b]=l.useState(!0),[u,m]=l.useState(null),f=l.useCallback(async()=>{const t=L();if(!t){m("API URL not set. For local dev, edit public/config.js and set window.API_BASE_URL to your staging API (e.g. terraform -chdir=infra output -raw apiInvokeUrl)."),b(!1);return}b(!0),m(null);try{const r=await k(`${t}/recommended/highest-rated`),a=await r.text();if(!r.ok)throw new Error(a||`HTTP ${r.status}`);if(a.trim().startsWith("<"))throw new Error("API returned HTML instead of JSON. For local dev, set window.API_BASE_URL in public/config.js to your staging API URL (e.g. terraform -chdir=infra output -raw apiInvokeUrl)");let n;try{n=JSON.parse(a)}catch{throw new Error("API returned invalid JSON.")}const x=Array.isArray(n.sites)?n.sites:[];p(x),m(null)}catch(r){const a=r instanceof Error?r.message:"Failed to load.";m(a),p([])}finally{b(!1)}},[]);l.useEffect(()=>{f()},[f]);const j=A(o??null,"manager");return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-amber-200",children:"Highest rated"}),e.jsxs("div",{className:"rounded-xl border border-amber-800/60 bg-gradient-to-br from-amber-900/40 to-amber-950/60 p-4 shadow-lg",children:[e.jsx("p",{className:"text-sm font-medium text-amber-100",children:"Top sites and media rated by our community"}),e.jsx("p",{className:"mt-1 text-xs text-amber-200/80",children:"Click a card below for more detail"}),j&&e.jsx("p",{className:"mt-2",children:e.jsx(h,{to:"/admin/recommended?tab=highest-rated",className:"text-amber-300 hover:text-amber-200 font-semibold text-sm",children:"Edit list"})})]}),g&&e.jsx("p",{className:"text-sm text-slate-400",children:"Loadingâ€¦"}),u&&!i.length&&e.jsx("div",{className:"rounded-md border border-red-500/60 bg-red-500/10 px-3 py-2 text-xs text-red-200",children:u}),!g&&i.length===0&&!u&&e.jsxs("p",{className:"text-sm text-slate-400",children:["No items configured yet."," ",j&&e.jsx(h,{to:"/admin/recommended?tab=highest-rated",className:"text-amber-400 hover:text-amber-300",children:"Generate cache"})]}),i.length>0&&e.jsx("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(260px,1fr))] gap-4",children:i.map(t=>{const r=(t.status||"up").toLowerCase(),a=r==="up"?"border-amber-400/50 bg-amber-400/20 text-amber-200":r==="degraded"?"border-amber-500/50 bg-amber-500/15 text-amber-200":"border-amber-600/50 bg-amber-600/15 text-amber-200",n=(t.description||"").trim().length>0,x=t.title||t.domain,w=t.type==="media",N=t.id||t.url||t.domain;return e.jsxs("div",{className:`rounded-lg border p-4 text-left text-sm min-w-0 cursor-pointer transition-all duration-200 hover:scale-[1.01] hover:shadow-lg ${a}`,onClick:()=>c(t),role:"button",tabIndex:0,onKeyDown:s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),c(t))},children:[e.jsxs("span",{className:"relative group block",children:[w?e.jsx(h,{to:t.link,className:"font-semibold block hover:underline break-all",onClick:s=>s.stopPropagation(),children:x}):e.jsx("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",className:"font-semibold block hover:underline break-all",onClick:s=>s.stopPropagation(),children:x}),e.jsx("span",{className:"absolute left-0 top-full mt-1 px-2 py-1.5 rounded bg-slate-900 border border-amber-700/60 text-xs text-amber-200 break-all max-w-[280px] shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-opacity z-10 pointer-events-none",role:"tooltip",children:t.link})]}),t.averageRating!=null&&e.jsxs("div",{className:"mt-1 flex items-center gap-0.5 text-amber-300",children:[e.jsx(I,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"font-medium",children:t.averageRating})]}),n&&e.jsx("div",{className:"mt-2 text-xs text-amber-200/90 leading-relaxed break-words",children:t.description})]},N)})}),e.jsxs(v,{open:!!d,onClose:()=>c(null),className:"relative z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50","aria-hidden":"true"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsx(v.Panel,{className:"mx-auto w-full max-w-xl rounded-xl border border-amber-800/60 bg-gradient-to-br from-amber-900/40 to-amber-950/60 p-6 shadow-xl",children:d&&e.jsxs("div",{className:"relative flex min-h-[12rem] items-center justify-center",children:[e.jsx("button",{type:"button",onClick:()=>c(null),className:"absolute right-0 top-0 rounded p-1 text-amber-400 hover:bg-amber-800/40 hover:text-amber-200","aria-label":"Close modal",children:e.jsx(E,{className:"h-6 w-6"})}),d.logoUrl?e.jsx("img",{src:d.logoUrl,alt:"",className:"max-h-48 max-w-full object-contain",onError:t=>{t.currentTarget.style.visibility="hidden"}}):e.jsx("div",{className:"h-24 w-24 rounded-lg border border-amber-700/60 bg-amber-900/40"})]})})})]})]})};export{C as default};
