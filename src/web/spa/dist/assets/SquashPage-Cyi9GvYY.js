import{u as ie,a as me,r as a,k as xe,l as he,j as t,L as Q,c as V}from"./index-Bal_br-M.js";import{D as q}from"./DateInput-BdAi7vlS.js";function X(){if(typeof window>"u")return null;const x=window.API_BASE_URL;return x?x.replace(/\/$/,""):null}const E=10,fe=()=>{const{user:x}=ie(),[o,F]=me(),[I,ee]=a.useState([]),[c,S]=a.useState(()=>{const e=o.get("playerIds");return e?e.split(",").filter(Boolean):[]}),[$,T]=a.useState([]),[h,u]=a.useState(1),[v,L]=a.useState(!1),[p,O]=a.useState(()=>o.get("date")??""),[b,R]=a.useState(()=>o.get("dateFrom")??""),[f,G]=a.useState(()=>o.get("dateTo")??""),[P,C]=a.useState(""),[M,U]=a.useState(!1),[_,ue]=a.useState(null),[D,k]=a.useState(null),[K,z]=a.useState(!1),[g,H]=a.useState(()=>o.get("sortOrder")==="oldest"?"oldest":"newest"),[N,A]=a.useState(()=>o.get("playerMode")==="or"?"or":"and"),B=a.useRef(null),w=xe(x),te=he(x),y=e=>{const s=I.find(n=>n.id===e||n.PK===e);return s&&(s.name||s.id)||e},se=async()=>{const e=X();if(e)try{const s=await V(`${e}/squash/players`);if(!s.ok){const l=await s.json().catch(()=>({}));throw new Error(l.error||"Failed")}const r=((await s.json()).players??[]).map(l=>({...l,id:l.id||l.PK||""}));ee(r)}catch(s){k((s==null?void 0:s.message)??"Failed to load players")}},J=async()=>{const e=X();if(!e)return;const s=new URLSearchParams;p&&s.set("date",p),b&&s.set("dateFrom",b),f&&s.set("dateTo",f),c.length&&(s.set("playerIds",c.join(",")),s.set("playerMode",N));const n=s.toString()?`?${s.toString()}`:"";z(!0),k(null);try{const r=await V(`${e}/squash/matches${n}`);if(!r.ok){const de=await r.json().catch(()=>({}));throw new Error(de.error||"Failed")}const l=await r.json();T(l.matches??[]),L(!0),u(1);const m=new URLSearchParams;p&&m.set("date",p),b&&m.set("dateFrom",b),f&&m.set("dateTo",f),c.length&&(m.set("playerIds",c.join(",")),m.set("playerMode",N)),m.set("sortOrder",g),F(m,{replace:!0})}catch(r){k((r==null?void 0:r.message)??"Failed to search matches")}finally{z(!1)}},ae=()=>{O(""),R(""),G(""),S([]),C(""),A("and"),L(!1),T([]),u(1),F({},{replace:!0})},re=e=>{c.includes(e)||S([...c,e]),C("")},le=e=>{S(c.filter(s=>s!==e))},W=I.filter(e=>!c.includes(e.id)&&(!P.trim()||(e.name||"").toLowerCase().includes(P.toLowerCase())));a.useEffect(()=>{w&&se()},[w]);const ne=o.get("date")||o.get("dateFrom")||o.get("dateTo")||o.get("playerIds");a.useEffect(()=>{!w||!ne||J()},[]),a.useEffect(()=>{function e(s){B.current&&!B.current.contains(s.target)&&U(!1)}if(M)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[M]);const j=a.useMemo(()=>{const e=[...$];return e.sort((s,n)=>{const r=s.date||"",l=n.date||"";return g==="newest"?l.localeCompare(r):r.localeCompare(l)}),e},[$,g]),d=Math.max(1,Math.ceil(j.length/E)),Y=(h-1)*E,Z=j.slice(Y,Y+E),oe=e=>{const s=e.teamAGames??0,n=e.teamBGames??0,r=e.winningTeam==="B"?n:s,l=e.winningTeam==="B"?s:n;return`${r}-${l}`},ce=e=>{const s=[y(e.teamAPlayer1Id||""),y(e.teamAPlayer2Id||"")].filter(Boolean).join(" & "),n=[y(e.teamBPlayer1Id||""),y(e.teamBPlayer2Id||"")].filter(Boolean).join(" & "),r=e.winningTeam==="B"?n:s,l=e.winningTeam==="B"?s:n;return t.jsxs("li",{className:"flex items-center gap-2 flex-wrap py-2 border-b border-slate-800 last:border-0",children:[t.jsx("span",{className:"font-semibold text-slate-200",children:e.date||""}),t.jsxs("span",{className:"text-slate-300",children:[r," vs ",l]}),t.jsx("span",{className:"italic text-slate-400",children:oe(e)})]},e.id||e.date+r)},i=[];if(d<=7)for(let e=1;e<=d;e++)i.push(e);else{const e=h;i.push(1),e>3&&i.push("…");for(let s=Math.max(2,e-1);s<=Math.min(d-1,e+1);s++)i.includes(s)||i.push(s);e<d-2&&i.push("…"),d>1&&i.push(d)}return x?w?t.jsxs("div",{className:"space-y-6",children:[t.jsx("h1",{className:"text-xl font-semibold text-slate-100",children:"Squash Doubles"}),te&&t.jsx("p",{className:"text-sm text-slate-400",children:t.jsx(Q,{to:"/squash-admin",className:"text-brand-orange hover:text-orange-400",children:"Squash Admin"})}),(_||D)&&t.jsx("div",{className:`rounded-md px-4 py-3 text-sm ${D?"bg-red-900/30 border border-red-800/50 text-red-200":"bg-emerald-900/30 border border-emerald-800/50 text-emerald-200"}`,children:D||_}),t.jsxs("section",{children:[t.jsx("h2",{className:"text-base font-semibold text-slate-200 mb-3",children:"Search matches"}),t.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[t.jsx(q,{id:"searchDate",value:p,onChange:O,label:"Date (exact)",className:"max-w-[12rem]"}),t.jsx(q,{id:"searchDateFrom",value:b,onChange:R,label:"Date from",className:"max-w-[12rem]"}),t.jsx(q,{id:"searchDateTo",value:f,onChange:G,label:"Date to",className:"max-w-[12rem]"}),t.jsxs("div",{className:"relative max-w-[14rem] min-w-[12rem]",ref:B,children:[t.jsx("label",{className:"block text-xs font-semibold text-slate-400 mb-1",children:"Filter by players"}),t.jsx("input",{type:"text",value:P,onChange:e=>C(e.target.value),onFocus:()=>U(!0),placeholder:"Search players...",autoComplete:"off",className:"block w-full rounded-md border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-200 focus:border-brand-orange focus:outline-none"}),M&&t.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-slate-900 border border-slate-700 rounded-md max-h-48 overflow-y-auto scrollbar-thin z-10",children:W.length?W.map(e=>t.jsx("button",{type:"button",onClick:()=>re(e.id),className:"w-full text-left px-3 py-2 text-sm text-slate-200 hover:bg-slate-800",children:e.name||e.id},e.id)):t.jsx("div",{className:"px-3 py-2 text-sm text-slate-500",children:"No matches"})}),t.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:c.map(e=>t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-slate-700 text-slate-200 text-xs",children:[y(e),t.jsx("button",{type:"button",onClick:()=>le(e),className:"text-slate-400 hover:text-slate-100","aria-label":"Remove",children:"×"})]},e))}),c.length>0&&t.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[t.jsx("span",{className:"text-xs text-slate-500",children:"Match:"}),t.jsxs("div",{className:"inline-flex rounded-md border border-slate-700 bg-slate-950 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>A("and"),className:`rounded px-2 py-0.5 text-xs font-medium ${N==="and"?"bg-brand-orange text-slate-950":"text-slate-400 hover:text-slate-200"}`,children:"AND"}),t.jsx("button",{type:"button",onClick:()=>A("or"),className:`rounded px-2 py-0.5 text-xs font-medium ${N==="or"?"bg-brand-orange text-slate-950":"text-slate-400 hover:text-slate-200"}`,children:"OR"})]})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{type:"button",onClick:J,disabled:K,className:"rounded-md bg-brand-orange px-4 py-2 text-sm font-medium text-slate-950 hover:bg-orange-500 disabled:opacity-50",children:K?"Searching…":"Search"}),t.jsx("button",{type:"button",onClick:ae,className:"rounded-md border border-slate-600 px-4 py-2 text-sm font-medium text-slate-300 hover:bg-slate-800",children:"Clear"})]})]})]}),t.jsxs("section",{children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-3",children:[t.jsx("h2",{className:"text-base font-semibold text-slate-200",children:"Results"}),v&&j.length>0&&t.jsxs("div",{className:"inline-flex rounded-md border border-slate-700 bg-slate-950 p-0.5",children:[t.jsx("button",{type:"button",onClick:()=>H("newest"),className:`rounded px-2 py-0.5 text-xs font-medium ${g==="newest"?"bg-brand-orange text-slate-950":"text-slate-400 hover:text-slate-200"}`,children:"Newest first"}),t.jsx("button",{type:"button",onClick:()=>H("oldest"),className:`rounded px-2 py-0.5 text-xs font-medium ${g==="oldest"?"bg-brand-orange text-slate-950":"text-slate-400 hover:text-slate-200"}`,children:"Oldest first"})]})]}),v&&t.jsx("div",{className:"rounded-md border border-slate-800 bg-slate-950/60 px-3 py-2 text-sm text-slate-400 mb-3",children:j.length===0?"No results":`${j.length} results`}),v?Z.length===0?t.jsx("ul",{className:"list-none p-0",children:t.jsx("li",{className:"py-2 text-slate-400",children:"No matches found."})}):t.jsxs(t.Fragment,{children:[t.jsx("ul",{className:"list-none p-0",children:Z.map(ce)}),d>1&&t.jsxs("div",{className:"flex items-center gap-2 mt-4 flex-wrap",children:[t.jsx("button",{type:"button",disabled:h<=1,onClick:()=>u(e=>Math.max(1,e-1)),className:"rounded-md border border-slate-600 px-3 py-1 text-sm disabled:opacity-50 disabled:cursor-not-allowed text-slate-300 hover:bg-slate-800",children:"Prev"}),t.jsx("span",{className:"flex items-center gap-1",children:i.map((e,s)=>e==="…"?t.jsx("span",{className:"px-1 text-slate-500",children:"…"},`ellipsis-${s}`):e===h?t.jsx("span",{className:"min-w-[2rem] px-2 py-1 text-center font-semibold text-slate-200",children:e},e):t.jsx("button",{type:"button",onClick:()=>u(e),className:"min-w-[2rem] rounded px-2 py-1 text-sm text-slate-300 hover:bg-slate-800 border border-slate-600",children:e},e))}),t.jsx("button",{type:"button",disabled:h>=d,onClick:()=>u(e=>Math.min(d,e+1)),className:"rounded-md border border-slate-600 px-3 py-1 text-sm disabled:opacity-50 disabled:cursor-not-allowed text-slate-300 hover:bg-slate-800",children:"Next"})]})]}):t.jsx("div",{className:"flex items-center justify-center min-h-[280px]",children:t.jsx("p",{className:"text-2xl sm:text-3xl font-light text-slate-500/80 tracking-wide animate-pulse",children:"Enter search criteria and click Search to find matches."})})]})]}):t.jsxs("div",{className:"space-y-4",children:[t.jsx("h1",{className:"text-xl font-semibold text-slate-100",children:"Squash Doubles"}),t.jsx("div",{className:"rounded-md bg-amber-900/30 border border-amber-800/50 px-4 py-3 text-sm text-amber-200",children:"You do not have access to the Squash section. Join the Squash group or contact an admin."})]}):t.jsxs("div",{className:"space-y-4",children:[t.jsx("h1",{className:"text-xl font-semibold text-slate-100",children:"Squash Doubles"}),t.jsxs("div",{className:"rounded-md bg-red-900/30 border border-red-800/50 px-4 py-3 text-sm text-red-200",children:["Sign in required. ",t.jsx(Q,{to:"/auth",className:"underline hover:text-red-100",children:"Sign in"})]})]})};export{fe as default};
