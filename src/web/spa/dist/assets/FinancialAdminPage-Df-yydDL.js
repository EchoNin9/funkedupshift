import{u as B,a as L,r as a,c as A,o as R,j as e,L as U}from"./index-CqR0r56c.js";import{F as M}from"./ArrowLeftIcon-NR7umhpe.js";function k(){if(typeof window>"u")return null;const r=window.API_BASE_URL;return r?r.replace(/\/$/,""):null}const O=()=>{const{user:r}=B(),[F,C]=L(),o=F.get("tab"),E=o==="members"?"members":o==="symbols"?"symbols":"overview",[l,i]=a.useState(E),[c,m]=a.useState([]),[u,h]=a.useState("yahoo"),[P,p]=a.useState(!1),[y,f]=a.useState(!1),[g,d]=a.useState(null),[v,j]=a.useState(null),[x,S]=a.useState(""),[T]=a.useState(["yahoo","alpha_vantage"]);a.useEffect(()=>{i(o==="members"?"members":o==="symbols"?"symbols":"overview")},[o]);const b=s=>{i(s),C(s==="overview"?{}:{tab:s},{replace:!0})},w=a.useCallback(async()=>{const s=k();if(s){p(!0),d(null);try{const t=await A(`${s}/admin/financial/default-symbols`);if(!t.ok)throw new Error("Failed to load");const n=await t.json();m(n.symbols??[]),h(n.source??"yahoo")}catch(t){d((t==null?void 0:t.message)??"Failed to load")}finally{p(!1)}}},[]);a.useEffect(()=>{l==="symbols"&&w()},[l,w]);const N=()=>{const s=x.trim().toUpperCase();!s||c.includes(s)||(m(t=>[...t,s]),S(""))},D=s=>{m(t=>t.filter(n=>n!==s))},$=async()=>{const s=k();if(s){f(!0),d(null),j(null);try{const t=await A(`${s}/admin/financial/default-symbols`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({symbols:c,source:u})});if(!t.ok){const n=await t.json().catch(()=>({}));throw new Error(n.error??"Failed to save")}j("Default symbols saved.")}catch(t){d((t==null?void 0:t.message)??"Failed to save")}finally{f(!1)}}};return R(r)?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(U,{to:"/financial",className:"inline-flex items-center gap-1 text-sm text-slate-400 hover:text-slate-200",children:[e.jsx(M,{className:"h-4 w-4"}),"Back to Financial"]}),e.jsxs("header",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-slate-50",children:"Financial Admin"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Manage Financial section settings, members, and data sources."})]}),e.jsxs("div",{className:"flex gap-2 border-b border-slate-800 pb-2",children:[e.jsx("button",{type:"button",onClick:()=>b("overview"),className:`px-4 py-2 rounded-md text-sm font-medium ${l==="overview"?"bg-slate-800 text-slate-100":"text-slate-400 hover:text-slate-200"}`,children:"Overview"}),e.jsx("button",{type:"button",onClick:()=>b("symbols"),className:`px-4 py-2 rounded-md text-sm font-medium ${l==="symbols"?"bg-slate-800 text-slate-100":"text-slate-400 hover:text-slate-200"}`,children:"Tracked Symbols"}),e.jsx("button",{type:"button",onClick:()=>b("members"),className:`px-4 py-2 rounded-md text-sm font-medium ${l==="members"?"bg-slate-800 text-slate-100":"text-slate-400 hover:text-slate-200"}`,children:"Members"})]}),l==="overview"&&e.jsxs("div",{className:"rounded-xl border border-slate-800 bg-slate-950/60 p-6 text-sm text-slate-400",children:[e.jsx("p",{className:"mb-2",children:"Admin configuration:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-slate-500",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Tracked symbols"})," – Default symbols for new users' watchlists"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Data source"})," – Yahoo Finance (no key) or Alpha Vantage (API key in Terraform)"]})]})]}),l==="symbols"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newSymbol",className:"block text-xs text-slate-500 mb-1",children:"Add symbol"}),e.jsx("input",{id:"newSymbol",type:"text",value:x,onChange:s=>S(s.target.value.toUpperCase()),onKeyDown:s=>s.key==="Enter"&&(s.preventDefault(),N()),placeholder:"AAPL",className:"rounded-md border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50 w-24"})]}),e.jsx("button",{type:"button",onClick:N,disabled:!x.trim(),className:"rounded-md bg-brand-orange px-3 py-2 text-sm font-medium text-slate-950 hover:bg-orange-500 disabled:opacity-50",children:"Add"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-500 mb-1",children:"Default data source"}),e.jsx("select",{value:u,onChange:s=>h(s.target.value),className:"rounded-md border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-50",children:T.map(s=>e.jsx("option",{value:s,children:s==="yahoo"?"Yahoo Finance":"Alpha Vantage"},s))})]}),c.length>0&&e.jsx("ul",{className:"flex flex-wrap gap-2",children:c.map(s=>e.jsxs("li",{className:"inline-flex items-center gap-1 rounded-md bg-slate-800 px-2 py-1 text-sm text-slate-200",children:[s,e.jsx("button",{type:"button",onClick:()=>D(s),className:"text-slate-500 hover:text-red-400","aria-label":`Remove ${s}`,children:"×"})]},s))}),e.jsx("button",{type:"button",onClick:$,disabled:y||P,className:"rounded-md bg-brand-orange px-4 py-2 text-sm font-semibold text-slate-950 hover:bg-orange-500 disabled:opacity-50",children:y?"Saving…":"Save defaults"}),v&&e.jsx("div",{className:"rounded-md border border-emerald-500/60 bg-emerald-500/10 px-3 py-2 text-sm text-emerald-200",children:v}),g&&e.jsx("div",{className:"rounded-md border border-red-500/60 bg-red-500/10 px-3 py-2 text-sm text-red-200",children:g})]}),l==="members"&&e.jsx("div",{className:"rounded-xl border border-slate-800 bg-slate-950/60 p-6 text-sm text-slate-400",children:e.jsx("p",{className:"mb-2",children:"Financial access is RBAC-based: guests view default symbols (session-only custom symbols); logged-in users can save their watchlist. No custom group required."})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-slate-50",children:"Financial Admin"}),e.jsx("p",{className:"text-sm text-slate-400",children:"SuperAdmin access is required."})]})};export{O as default};
