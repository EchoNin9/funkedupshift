import{b as P,u as E,r as n,h as L,j as e,L as d,f as $,c as k}from"./index-Cx0qYlZr.js";import{F as u}from"./ArrowLeftIcon-Cn-75ax8.js";import{F as B}from"./PencilSquareIcon-DKwtlkEC.js";function v(){if(typeof window>"u")return null;const i=window.API_BASE_URL;return i?i.replace(/\/$/,""):null}const C=()=>{var N;const{id:i}=P(),{user:p}=E(),[t,h]=n.useState(null),[c,b]=n.useState(null),[w,o]=n.useState(!0),[f,x]=n.useState(null),y=L(p??null,"manager"),r=i?decodeURIComponent(i):"";n.useEffect(()=>{const a=v();if(!a||!r){x(r?"API URL not set.":"Missing media id."),o(!1);return}let s=!1;async function U(){o(!0),x(null);try{const l=await $(`${a}/media?id=${encodeURIComponent(r)}`);if(l.status===404){s||h(null);return}if(!l.ok){const A=await l.text();throw new Error(`HTTP ${l.status}: ${A}`)}const m=await l.json();if(s)return;const I=Array.isArray(m.media)?m.media[0]:m.media;h(I??null)}catch(l){s||x((l==null?void 0:l.message)??"Failed to load media.")}finally{s||o(!1)}}return U(),()=>{s=!0}},[r]);const R=async a=>{const s=v();if(!(!s||!t))try{await k(`${s}/media/stars`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mediaId:t.PK,rating:a})}),b(a)}catch{}};if(w)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(d,{to:"/media",className:"inline-flex items-center gap-1 text-sm text-slate-400 hover:text-slate-200",children:[e.jsx(u,{className:"h-4 w-4"}),"Back to Media"]}),e.jsx("div",{className:"text-sm text-slate-400",children:"Loading…"})]});if(f||!t)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(d,{to:"/media",className:"inline-flex items-center gap-1 text-sm text-slate-400 hover:text-slate-200",children:[e.jsx(u,{className:"h-4 w-4"}),"Back to Media"]}),e.jsx("div",{className:"rounded-md border border-slate-700 bg-slate-900/60 px-4 py-3 text-slate-200",children:f||"Media not found."})]});const g=t.title||t.PK||"Untitled",j=t.mediaType==="video";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(d,{to:"/media",className:"inline-flex items-center gap-1 text-sm text-slate-400 hover:text-slate-200",children:[e.jsx(u,{className:"h-4 w-4"}),"Back to Media"]}),y&&e.jsxs(d,{to:`/admin/media/edit/${encodeURIComponent(t.PK)}`,className:"inline-flex items-center gap-1 text-sm text-slate-400 hover:text-slate-200",children:[e.jsx(B,{className:"h-4 w-4"}),"Edit"]})]}),e.jsxs("article",{className:"rounded-xl border border-slate-800 bg-slate-950/60 overflow-hidden",children:[e.jsxs("header",{className:"p-4 sm:p-6 border-b border-slate-800",children:[e.jsx("h1",{className:"text-xl font-semibold tracking-tight text-slate-50",children:g}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[typeof t.averageRating=="number"&&e.jsxs("span",{className:"inline-flex items-center rounded-full bg-slate-800 px-2 py-0.5 text-sm text-amber-300",children:[t.averageRating.toFixed(1),"★ average"]}),e.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-800 px-2 py-0.5 text-xs uppercase tracking-wide text-slate-400",children:j?"Video":"Image"})]}),t.description&&e.jsx("p",{className:"mt-3 text-sm text-slate-300",children:t.description}),(((N=t.categories)==null?void 0:N.length)??0)>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-1",children:t.categories.map(a=>e.jsx("span",{className:"rounded-full bg-slate-800 px-2 py-0.5 text-xs text-slate-300",children:a.name},a.id))}),p&&e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-3",children:[c!==null&&e.jsxs("span",{className:"text-xs text-slate-400",children:["Your rating: ",c,"★"]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-slate-400",children:[e.jsx("span",{children:"Rate:"}),e.jsxs("select",{className:"rounded border border-slate-700 bg-slate-950 px-2 py-1 text-sm text-slate-50",value:c??"",onChange:a=>{const s=Number(a.target.value);s>=1&&s<=5&&R(s)},children:[e.jsx("option",{value:"",children:"--"}),e.jsx("option",{value:"1",children:"1"}),e.jsx("option",{value:"2",children:"2"}),e.jsx("option",{value:"3",children:"3"}),e.jsx("option",{value:"4",children:"4"}),e.jsx("option",{value:"5",children:"5"})]})]})]})]}),e.jsx("div",{className:"p-4 sm:p-6 bg-slate-900/40 flex justify-center items-center min-h-[200px]",children:t.mediaUrl?j?e.jsx("video",{src:t.mediaUrl,controls:!0,className:"max-w-full max-h-[70vh] rounded-lg border border-slate-700",playsInline:!0}):e.jsx("img",{src:t.mediaUrl,alt:g,className:"max-w-full max-h-[70vh] w-auto h-auto object-contain rounded-lg border border-slate-700"}):e.jsx("p",{className:"text-sm text-slate-500",children:"No media URL available."})})]})]})};export{C as default};
